import{E as oe,a as X,p as le,G as E,q as pe,s as fe,r as d,H as ne,e as f,o as k,k as U,w as o,d as a,b as M,t as A,u,z as ge,C as _e,f as n,n as S,I as ye,J as he,c as K,F as Q,l as z,M as ee,g as xe,h as be}from"./index-CoCbkXPQ.js";import{c as te,t as ae}from"./index-zKOuXdVJ.js";import{_ as ke,a as we,b as W,c as Ce}from"./AutoComplete-BbSkswQ5.js";import{_ as $e}from"./RoleSelectField-Defb2Img.js";const Ve=["textContent"],Ue={__name:"PermissionDialog",props:oe({reloadFunction:{}},{dialog:{},dialogModifiers:{},permission:{},permissionModifiers:{}}),emits:["update:dialog","update:permission"],setup(w){const P=X(),y=le(),c=E(w,"dialog"),s=E(w,"permission"),C=w,{handleSubmit:$}=pe({validationSchema:{name:"required"}}),m=fe("name"),p=d(!1),h=d(!1);ne(c,v=>{v&&s.value?(m.setValue(s.value.name),h.value=!1):(s.value=null,m.resetField(),h.value=!0)});const r=$(async v=>{p.value=!0;try{var l=await fetch(f.permissionCreate.url,{method:f.permissionCreate.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(v)});l=await l.json(),y.notify(l.message,"success"),c.value=!1,C.reloadFunction()}catch(g){console.log(g)}finally{p.value=!1}}),i=$(async v=>{var g;p.value=!0;try{const _=(g=s.value)==null?void 0:g.id;var l=await fetch(`${f.permissionUpdate.url}?permission_id=${_}`,{method:f.permissionUpdate.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(v)});l=await l.json(),y.notify(l.message,"success"),c.value=!1,C.reloadFunction()}catch(_){console.log(_)}finally{p.value=!1}});return(v,l)=>{const g=n("v-btn"),_=n("v-card-title"),x=n("v-divider"),b=n("v-text-field"),j=n("v-card-text"),F=n("v-card-actions"),I=n("v-card"),J=n("v-form"),O=n("v-dialog");return k(),U(O,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=V=>c.value=V),"max-width":"400",persistent:p.value},{default:o(()=>[a(J,{onSubmit:l[3]||(l[3]=_e(V=>h.value?u(r)():u(i)(),["prevent"]))},{default:o(()=>[a(I,{loading:p.value,rounded:"lg"},{default:o(()=>[a(_,{class:"d-flex justify-space-between align-center"},{default:o(()=>[M("div",{textContent:A(h.value?"Create new permission":"Edit permission")},null,8,Ve),a(g,{icon:"$close",variant:"text",onClick:l[0]||(l[0]=V=>c.value=!1),disabled:p.value},null,8,["disabled"])]),_:1}),a(x,{class:"mb-4"}),a(j,null,{default:o(()=>[a(b,{"prepend-inner-icon":u(ge),modelValue:u(m).value.value,"onUpdate:modelValue":l[1]||(l[1]=V=>u(m).value.value=V),"error-messages":u(m).errorMessage.value,label:"Name",variant:"outlined",clearable:"","persistent-clear":"",disabled:p.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),a(x),a(F,{class:"ma-2"},{default:o(()=>[a(g,{type:"button",text:"Cancel",onClick:l[2]||(l[2]=V=>c.value=!1),disabled:p.value},null,8,["disabled"]),a(g,{type:"submit",color:h.value?"success":"primary",variant:"flat",text:h.value?"Create":"Update",loading:p.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1},8,["modelValue","persistent"])}}},Pe={__name:"PermissionDeleteDialog",props:oe({reloadFunction:{}},{dialog:{},dialogModifiers:{},permission:{},permissionModifiers:{},permissions:{},permissionsModifiers:{}}),emits:["update:dialog","update:permission","update:permissions"],setup(w){const P=X(),y=le(),c=E(w,"dialog"),s=E(w,"permission"),C=E(w,"permissions"),$=w,m=d(!1);ne(c,r=>{r||(s.value=null,C.value.length=0)});async function p(){var i;m.value=!0;try{const v=(i=s.value)==null?void 0:i.id;var r=await fetch(`${f.permissionDelete.url}?permission_id=${v}`,{method:f.permissionDelete.method,headers:{Authorization:P.token}});r=await r.json(),y.notify(r.message,"success"),c.value=!1,$.reloadFunction()}catch(v){console.log(v)}finally{m.value=!1}}async function h(){m.value=!0;try{var r=await fetch(f.permissioneleteMany.url,{method:f.permissioneleteMany.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(C.value)});r=await r.json(),y.notify(r.message,"success"),c.value=!1,$.reloadFunction()}catch(i){console.log(i)}finally{m.value=!1}}return(r,i)=>{const v=n("v-card-text"),l=n("v-btn"),g=n("v-card-actions"),_=n("v-card"),x=n("v-dialog");return k(),U(x,{modelValue:c.value,"onUpdate:modelValue":i[2]||(i[2]=b=>c.value=b),"max-width":"400",persistent:m.value},{default:o(()=>[a(_,{title:`Delete ${s.value?"Permission":"Permissions"}`,loading:m.value,rounded:"lg"},{default:o(()=>[a(v,null,{default:o(()=>[S(" Are you sure you want to delete "+A(s.value?"this permission":"the selected permissions")+"? ",1)]),_:1}),a(g,{class:"ma-2"},{default:o(()=>[a(l,{text:"Cancel",onClick:i[0]||(i[0]=b=>c.value=!1),disabled:m.value},null,8,["disabled"]),a(l,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:i[1]||(i[1]=b=>s.value?p():h()),loading:m.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},De={class:"mb-5"},Me={class:"d-flex align-center ga-2 opacity-80"},Ae=["textContent"],ze={class:"d-flex ga-2 align-center"},je={class:"text-no-wrap"},Fe={class:"text-no-wrap"},Le={class:"text-no-wrap"},Ee={__name:"PermissionListView",setup(w){const P=be(),y=X(),c=ye(),s=d(!1),C=d([]),$=d([]),m=d(0),p=d(0),h=d(""),r=d(1),i=d(10),v=d([{key:"updated_at",order:"desc"}]),l=d(),g=d([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"Name",key:"name"},{title:"Roles",key:"roles",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"}]);async function _(){var N,T,R,q;s.value=!0;try{var D={page:r.value,limit:i.value,query:h.value,roles:l.value?l.value.join(","):"",sort_by:(N=v.value.at(0))==null?void 0:N.key,sort_order:(T=v.value.at(0))==null?void 0:T.order};D=new URLSearchParams(D);const B=`${f.permissionList.url}?${D.toString()}`;var t=await fetch(B,{method:f.permissionList.method,headers:{Authorization:y.token}});t=await t.json(),$.value=t==null?void 0:t.data,m.value=(R=t==null?void 0:t.pagination)==null?void 0:R.total,p.value=(q=t==null?void 0:t.pagination)==null?void 0:q.filtered}catch(B){console.log(B)}finally{s.value=!1}}he(()=>{y.isLoggedIn&&_()});const x=d(),b=d([]),j=d(!1),F=d(!1),I=y.isAuthorized(f.permissionCreate.permission),J=y.isAuthorized(f.permissionUpdate.permission),O=y.isAuthorized(f.permissionDelete.permission),V=y.isAuthorized(f.permissioneleteMany.permission),se=te([J,O]),Y=te([V]);se||g.value.shift();function ie(){x.value=null,j.value=!0}function re(D){x.value=D,j.value=!0}function de(D){x.value=D,F.value=!0}function ue(){F.value=!0}return(D,t)=>{const N=n("v-icon"),T=n("v-col"),R=n("v-row"),q=n("v-divider"),B=n("v-btn"),G=n("v-tooltip"),H=n("v-chip"),Z=n("v-card-text"),ce=n("v-card"),me=n("v-menu"),ve=n("v-data-table-server");return k(),K(Q,null,[M("div",De,[M("h1",Me,[a(N,{icon:u(P).meta.icon,size:"x-small"},null,8,["icon"]),M("span",{textContent:A(u(P).meta.title)},null,8,Ae)])]),a(R,{align:"center",justify:"start",class:"mb-2",dense:""},{default:o(()=>[a(T,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[M("div",ze,[a(N,{icon:"$filter",color:"medium-emphasis"}),a(we,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e)},null,8,["modelValue"])])]),_:1}),a(T,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[a($e,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),density:"compact",rounded:"pill","hide-details":"","items-visibility-count":1},null,8,["modelValue"])]),_:1})]),_:1}),a(ke,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=e=>C.value=e),"is-loading":s.value,"refresh-action":_,columns:g.value},{prepend:o(()=>[u(Y)?(k(),K(Q,{key:0},[u(V)&&b.value.length>0?(k(),U(W,{key:0,"tooltip-label":"Delete selected permissions","is-loading":s.value,onClick:ue,icon:"$delete",size:"default","change-color-on-hover":!1},null,8,["is-loading"])):z("",!0),b.value.length>0?(k(),U(q,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):z("",!0)],64)):z("",!0),u(I)?(k(),U(G,{key:1,text:"Create new role","open-on-click":""},{activator:o(({props:e})=>[a(B,ee({icon:"$plus",onClick:ie},e,{disabled:s.value}),null,16,["disabled"])]),_:1})):z("",!0)]),_:1},8,["modelValue","is-loading","columns"]),a(ve,{"loading-text":"loading permissions...",headers:C.value,items:$.value,"items-length":p.value,modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e),page:r.value,"onUpdate:page":t[6]||(t[6]=e=>r.value=e),"items-per-page":i.value,"onUpdate:itemsPerPage":t[7]||(t[7]=e=>i.value=e),"sort-by":v.value,"onUpdate:sortBy":t[8]||(t[8]=e=>v.value=e),loading:s.value,"onUpdate:options":_,"disable-sort":s.value,"must-sort":"",hover:"","show-select":u(Y),"header-props":{class:"text-no-wrap"}},{"item.actions":o(({item:e})=>[M("div",je,[u(J)?(k(),U(W,{key:0,"tooltip-label":"Edit","is-loading":s.value,onClick:L=>re(e),icon:"$edit"},null,8,["is-loading","onClick"])):z("",!0),u(O)&&!e.deleted?(k(),U(W,{key:1,"tooltip-label":"Delete","is-loading":s.value,onClick:L=>de(e),icon:"$delete","color-on-hover":"red"},null,8,["is-loading","onClick"])):z("",!0)])]),"item.roles":o(({value:e})=>[a(me,{"open-on-hover":"","open-on-click":""},{activator:o(({props:L})=>[a(H,ee(L,{link:""}),{default:o(()=>[S(A(e.length),1)]),_:2},1040)]),default:o(()=>[a(ce,{"max-width":"300","max-height":"300",rounded:"lg"},{default:o(()=>[a(Z,null,{default:o(()=>[S(A(e.length)+" roles",1)]),_:2},1024),e.length>0?(k(),U(Z,{key:0,class:"d-flex flex-wrap ga-1 pt-0"},{default:o(()=>[(k(!0),K(Q,null,xe(e,L=>(k(),U(H,{key:L.id},{default:o(()=>[S(A(L.name),1)]),_:2},1024))),128))]),_:2},1024)):z("",!0)]),_:2},1024)]),_:2},1024)]),"item.name":o(({value:e})=>[a(H,{class:"text-no-wrap font-weight-medium",density:"comfortable",text:e},null,8,["text"])]),"item.created_at":o(({value:e})=>[M("span",Fe,[S(A(u(ae)(e))+" ",1),a(G,{activator:"parent",text:u(c).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.updated_at":o(({value:e})=>[M("span",Le,[S(A(u(ae)(e))+" ",1),a(G,{activator:"parent",text:u(c).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),bottom:o(()=>[a(Ce,{class:"mt-2",page:r.value,"onUpdate:page":t[3]||(t[3]=e=>r.value=e),"items-per-page":i.value,"onUpdate:itemsPerPage":t[4]||(t[4]=e=>i.value=e),"items-count":$.value.length,total:m.value,filtered:p.value,label:"permissions"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),a(Ue,{dialog:j.value,"onUpdate:dialog":t[9]||(t[9]=e=>j.value=e),permission:x.value,"onUpdate:permission":t[10]||(t[10]=e=>x.value=e),"reload-function":_},null,8,["dialog","permission"]),a(Pe,{dialog:F.value,"onUpdate:dialog":t[11]||(t[11]=e=>F.value=e),permission:x.value,"onUpdate:permission":t[12]||(t[12]=e=>x.value=e),permissions:b.value,"onUpdate:permissions":t[13]||(t[13]=e=>b.value=e),"reload-function":_},null,8,["dialog","permission","permissions"])],64)}}};export{Ee as default};
