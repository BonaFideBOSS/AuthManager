import{E as se,a as le,p as ne,G,r as v,q as ce,s as O,H as ie,e as b,o as k,c as Q,d as t,w as s,C as me,b as w,t as I,u as a,k as R,l as q,D as pe,y as fe,z as ge,F as ee,f as n,n as te,I as _e,J as ye,K as be,L as Ue,g as xe,M as we,h as ke}from"./index-Bl9TM9gc.js";import{c as ae,t as oe}from"./index-zKOuXdVJ.js";import{_ as Ve,a as he,b as Z,c as $e}from"./AutoComplete-BZAlwESo.js";import{_ as Ce}from"./AvatarSelectorDialog-C780zqxq.js";import{_ as ue}from"./RoleSelectField-BKZjETtx.js";const De=["textContent"],Me={__name:"UserDialog",props:se({reloadFunction:{}},{dialog:{},dialogModifiers:{},user:{},userModifiers:{}}),emits:["update:dialog","update:user"],setup(C){const F=le(),V=ne(),m=G(C,"dialog"),d=G(C,"user"),h=v(!1),D=C,{handleSubmit:g,handleReset:N,setValues:P}=ce({validationSchema:{email:"required|email",username:"required|min:4,max:16",password:"required|min:6"}}),c=O("avatar"),r=O("username"),f=O("email"),U=O("password"),x=O("deleted"),M=O("roles"),u=v(!1),p=v(!1);ie(m,_=>{_&&d.value?(P(d.value),M.setValue(d.value.roles.map(o=>o.id)),p.value=!1):(d.value=null,N(),M.resetField({value:[]}),p.value=!0)});const A=g(async _=>{u.value=!0;try{m.value=!1,D.reloadFunction()}catch(o){console.log(o)}finally{u.value=!1}}),J=g(async _=>{var $;u.value=!0;try{const L=($=d.value)==null?void 0:$.id;var o=await fetch(`${b.userUpdate.url}?user_id=${L}`,{method:b.userUpdate.method,headers:{Authorization:F.token,"Content-Type":"application/json"},body:JSON.stringify(_)});o=await o.json(),V.notify(o.message,"success"),m.value=!1,D.reloadFunction()}catch(L){console.log(L)}finally{u.value=!1}});return(_,o)=>{const $=n("v-btn"),L=n("v-card-title"),H=n("v-divider"),K=n("v-avatar"),S=n("v-col"),Y=n("v-text-field"),W=n("v-row"),y=n("v-switch"),l=n("v-card-text"),z=n("v-card-actions"),j=n("v-card"),T=n("v-form"),B=n("v-dialog");return k(),Q(ee,null,[t(B,{modelValue:m.value,"onUpdate:modelValue":o[9]||(o[9]=i=>m.value=i),"max-width":_.$vuetify.display.smAndUp?"600":"",persistent:u.value,fullscreen:!_.$vuetify.display.smAndUp,scrollable:""},{default:s(()=>[t(T,{onSubmit:o[8]||(o[8]=me(i=>p.value?a(A)():a(J)(),["prevent"]))},{default:s(()=>[t(j,{loading:u.value,rounded:_.$vuetify.display.smAndUp?"lg":"0"},{default:s(()=>[t(L,{class:"d-flex justify-space-between align-center"},{default:s(()=>[w("div",{textContent:I(p.value?"Create new user":"Edit user")},null,8,De),t($,{icon:"$close",variant:"text",onClick:o[0]||(o[0]=i=>m.value=!1),disabled:u.value},null,8,["disabled"])]),_:1}),t(H),t(l,null,{default:s(()=>[t(W,{align:"center"},{default:s(()=>[t(S,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:s(()=>[a(c).value.value?(k(),R(K,{key:0,image:`${a(b).userAvatarURL}/${a(c).value.value}`,size:"80"},null,8,["image"])):q("",!0)]),_:1}),t(S,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:s(()=>[t($,{onClick:o[1]||(o[1]=i=>h.value=!0),text:"Change avatar",variant:"tonal",disabled:u.value},null,8,["disabled"])]),_:1}),t(S,{cols:"12",sm:"6"},{default:s(()=>[t(Y,{"prepend-inner-icon":a(pe),modelValue:a(r).value.value,"onUpdate:modelValue":o[2]||(o[2]=i=>a(r).value.value=i),"error-messages":a(r).errorMessage.value,label:"Username",variant:"outlined",disabled:u.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),t(S,{cols:"12",sm:"6"},{default:s(()=>[t(Y,{"prepend-inner-icon":a(fe),modelValue:a(f).value.value,"onUpdate:modelValue":o[3]||(o[3]=i=>a(f).value.value=i),"error-messages":a(f).errorMessage.value,label:"Email",variant:"outlined",disabled:u.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),t(S,{cols:"12",sm:"6"},{default:s(()=>[t(Y,{"prepend-inner-icon":a(ge),modelValue:a(U).value.value,"onUpdate:modelValue":o[4]||(o[4]=i=>a(U).value.value=i),"error-messages":a(U).errorMessage.value,label:"Password",variant:"outlined",disabled:u.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),t(S,{cols:"12",sm:"6"},{default:s(()=>[t(ue,{modelValue:a(M).value.value,"onUpdate:modelValue":o[5]||(o[5]=i=>a(M).value.value=i),disabled:u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t(y,{modelValue:a(x).value.value,"onUpdate:modelValue":o[6]||(o[6]=i=>a(x).value.value=i),color:a(x).value.value?"red-accent-4":"",label:`Deleted: ${a(x).value.value?"Yes":"No"}`,"hide-details":"",disabled:u.value},null,8,["modelValue","color","label","disabled"])]),_:1}),t(H),t(z,{class:"ma-2"},{default:s(()=>[t($,{type:"button",text:"Cancel",onClick:o[7]||(o[7]=i=>m.value=!1),disabled:u.value},null,8,["disabled"]),t($,{type:"submit",color:p.value?"success":"primary",variant:"flat",text:p.value?"Create":"Update",loading:u.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"]),t(Ce,{dialog:h.value,"onUpdate:dialog":o[10]||(o[10]=i=>h.value=i),avatar:a(c).value.value,"onUpdate:avatar":o[11]||(o[11]=i=>a(c).value.value=i)},null,8,["dialog","avatar"])],64)}}},Ae={__name:"UserDeleteDialog",props:se({reloadFunction:{}},{dialog:{},dialogModifiers:{},user:{},userModifiers:{},users:{default:[]},usersModifiers:{}}),emits:["update:dialog","update:user","update:users"],setup(C){const F=le(),V=ne(),m=G(C,"dialog"),d=G(C,"user"),h=G(C,"users"),D=C,g=v(!1);ie(m,c=>{c||(d.value=null,h.value.length=0)});async function N(){var r;g.value=!0;try{const f=(r=d.value)==null?void 0:r.id;var c=await fetch(`${b.userDelete.url}?user_id=${f}`,{method:b.userDelete.method,headers:{Authorization:F.token}});c=await c.json(),V.notify(c.message,"success"),m.value=!1,D.reloadFunction()}catch(f){console.log(f)}finally{g.value=!1}}async function P(){g.value=!0;try{var c=await fetch(b.userDeleteMany.url,{method:b.userDeleteMany.method,headers:{Authorization:F.token,"Content-Type":"application/json"},body:JSON.stringify(h.value)});c=await c.json(),V.notify(c.message,"success"),m.value=!1,D.reloadFunction()}catch(r){console.log(r)}finally{g.value=!1}}return(c,r)=>{const f=n("v-card-text"),U=n("v-btn"),x=n("v-card-actions"),M=n("v-card"),u=n("v-dialog");return k(),R(u,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=p=>m.value=p),"max-width":"400",persistent:g.value},{default:s(()=>[t(M,{title:`Delete ${d.value?"User":"Users"}`,loading:g.value,rounded:"lg"},{default:s(()=>[t(f,null,{default:s(()=>[te(" Are you sure you want to delete "+I(d.value?"this user":"the selected users")+"? ",1)]),_:1}),t(x,{class:"ma-2"},{default:s(()=>[t(U,{text:"Cancel",onClick:r[0]||(r[0]=p=>m.value=!1),disabled:g.value},null,8,["disabled"]),t(U,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:r[1]||(r[1]=p=>d.value?N():P()),loading:g.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},Le={class:"mb-5"},Se={class:"d-flex align-center ga-2 opacity-80"},ze=["textContent"],je={class:"d-flex ga-2 align-center"},Fe={class:"text-no-wrap"},Ne={class:"text-no-wrap"},Pe=["textContent"],Ee={class:"d-flex flex-wrap ga-1 my-1"},Re={key:0},Te={class:"text-no-wrap"},Be={class:"text-no-wrap"},Ge={__name:"UserListView",setup(C){const F=ke(),V=le(),m=_e(),d=v(!1),h=v([]),D=v([]),g=v(0),N=v(0),P=v(""),c=v(!0),r=v(),f=v(1),U=v(10),x=v([{key:"updated_at",order:"desc"}]),M=v([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"User",key:"username",value:y=>({avatar:y.avatar,username:y.username})},{title:"Email",key:"email"},{title:"Roles",key:"roles",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"},{title:"Deleted",key:"deleted"}]);async function u(){var z,j,T,B;d.value=!0;try{var y={page:f.value,limit:U.value,query:P.value,exclude_deleted:c.value,roles:r.value?r.value.join(","):"",sort_by:(z=x.value.at(0))==null?void 0:z.key,sort_order:(j=x.value.at(0))==null?void 0:j.order};y=new URLSearchParams(y);const i=`${b.userList.url}?${y.toString()}`;var l=await fetch(i,{method:b.userList.method,headers:{Authorization:V.token}});l=await l.json(),D.value=l==null?void 0:l.data,g.value=(T=l==null?void 0:l.pagination)==null?void 0:T.total,N.value=(B=l==null?void 0:l.pagination)==null?void 0:B.filtered}catch(i){console.log(i)}finally{d.value=!1}}ye(()=>{V.isLoggedIn&&u()});const p=v(null),A=v([]),J=v(!1),_=v(!1),o=V.isAuthorized(b.userUpdate.permission),$=V.isAuthorized(b.userDelete.permission),L=V.isAuthorized(b.userDeleteMany.permission),H=ae([o,$]),K=ae([L]);H||M.value.shift();function S(y){p.value=y,J.value=!0}function Y(y){p.value=y,_.value=!0}function W(){_.value=!0}return(y,l)=>{const z=n("v-icon"),j=n("v-col"),T=n("v-select"),B=n("v-row"),i=n("v-divider"),de=n("v-avatar"),re=n("v-chip"),X=n("v-tooltip"),ve=n("v-data-table-server");return k(),Q(ee,null,[w("div",Le,[w("h1",Se,[t(z,{icon:a(F).meta.icon,size:"x-small"},null,8,["icon"]),w("span",{textContent:I(a(F).meta.title)},null,8,ze)])]),t(B,{align:"center",justify:"start",class:"mb-2",dense:""},{default:s(()=>[t(j,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[w("div",je,[t(z,{icon:"$filter",color:"medium-emphasis"}),t(he,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value=e)},null,8,["modelValue"])])]),_:1}),t(j,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[t(T,{"prepend-inner-icon":a(Ue),modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value=e),label:"Show Deleted Users",items:[{label:"Yes",key:!1},{label:"No",key:!0}],"item-title":"label","item-value":"key",variant:"outlined",density:"compact",rounded:"pill","hide-details":""},null,8,["prepend-inner-icon","modelValue"])]),_:1}),t(j,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[t(ue,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=e=>r.value=e),density:"compact",rounded:"pill","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(Ve,{modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=e=>h.value=e),"is-loading":d.value,"refresh-action":u,columns:M.value},be({_:2},[a(K)?{name:"prepend",fn:s(()=>[a(L)&&A.value.length>0?(k(),R(Z,{key:0,"tooltip-label":"Delete selected users","is-loading":d.value,onClick:W,icon:"$delete",size:"default","change-color-on-hover":!1},null,8,["is-loading"])):q("",!0),A.value.length>0?(k(),R(i,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):q("",!0)]),key:"0"}:void 0]),1032,["modelValue","is-loading","columns"]),t(ve,{"loading-text":"loading users...",headers:h.value,items:D.value,"items-length":N.value,modelValue:A.value,"onUpdate:modelValue":l[6]||(l[6]=e=>A.value=e),page:f.value,"onUpdate:page":l[7]||(l[7]=e=>f.value=e),"items-per-page":U.value,"onUpdate:itemsPerPage":l[8]||(l[8]=e=>U.value=e),"sort-by":x.value,"onUpdate:sortBy":l[9]||(l[9]=e=>x.value=e),loading:d.value,"onUpdate:options":u,"disable-sort":d.value,"must-sort":"",hover:"","show-select":a(K),"header-props":{class:"text-no-wrap"}},{"item.actions":s(({item:e})=>[w("div",Fe,[a(o)?(k(),R(Z,{key:0,"tooltip-label":"Edit","is-loading":d.value,onClick:E=>S(e),icon:"$edit"},null,8,["is-loading","onClick"])):q("",!0),a($)&&!e.deleted?(k(),R(Z,{key:1,"tooltip-label":"Delete","is-loading":d.value,onClick:E=>Y(e),icon:"$delete","color-on-hover":"red"},null,8,["is-loading","onClick"])):q("",!0)])]),"item.username":s(({value:e})=>[w("div",Ne,[t(de,{image:`${a(b).userAvatarURL}/${e.avatar}`,start:""},null,8,["image"]),w("span",{class:"font-weight-medium",textContent:I(e.username)},null,8,Pe)])]),"item.roles":s(({value:e})=>[w("div",Ee,[(k(!0),Q(ee,null,xe(e,E=>(k(),R(re,{key:E.id,color:E.color,density:"compact",text:E.name},null,8,["color","text"]))),128)),e.length==0?(k(),Q("span",Re,"-")):q("",!0)])]),"item.created_at":s(({value:e})=>[w("span",Te,[te(I(a(oe)(e))+" ",1),t(X,{activator:"parent",text:a(m).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.updated_at":s(({value:e})=>[w("span",Be,[te(I(a(oe)(e))+" ",1),t(X,{activator:"parent",text:a(m).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.deleted":s(({item:e})=>[t(X,{"open-on-click":"",text:e.deleted?a(m).format(e.deleted_at,"fullDateTime12h"):"Not deleted"},{activator:s(({props:E})=>[t(z,we(E,{icon:"$delimiter",color:e.deleted?"red":"green",size:"x-small"}),null,16,["color"])]),_:2},1032,["text"])]),bottom:s(()=>[t($e,{class:"mt-2",page:f.value,"onUpdate:page":l[4]||(l[4]=e=>f.value=e),"items-per-page":U.value,"onUpdate:itemsPerPage":l[5]||(l[5]=e=>U.value=e),"items-count":D.value.length,total:g.value,filtered:N.value,label:"users"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),t(Me,{dialog:J.value,"onUpdate:dialog":l[10]||(l[10]=e=>J.value=e),user:p.value,"onUpdate:user":l[11]||(l[11]=e=>p.value=e),"reload-function":u},null,8,["dialog","user"]),t(Ae,{dialog:_.value,"onUpdate:dialog":l[12]||(l[12]=e=>_.value=e),user:p.value,"onUpdate:user":l[13]||(l[13]=e=>p.value=e),users:A.value,"onUpdate:users":l[14]||(l[14]=e=>A.value=e),"reload-function":u},null,8,["dialog","user","users"])],64)}}};export{Ge as default};
