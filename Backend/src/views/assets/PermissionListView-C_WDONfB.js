import{E as Z,a as G,p as ee,G as N,q as ue,s as me,r as v,H as te,e as g,o as U,k as M,w as l,d as a,b as V,t as T,u as o,z as ce,C as ve,f as i,n as I,I as pe,J as fe,c as Q,F as W,l as z,M as ge,h as _e}from"./index-8bYaaTru.js";import{p as ye,_ as be,a as he,b as q,c as xe,d as ke}from"./AutoComplete-BcJ8ShvW.js";import{c as X,t as Y}from"./index-zKOuXdVJ.js";import{_ as we}from"./RoleSelectField-BRxTpbs4.js";const Ce=["textContent"],$e={__name:"PermissionDialog",props:Z({reloadFunction:{}},{dialog:{},dialogModifiers:{},permission:{},permissionModifiers:{}}),emits:["update:dialog","update:permission"],setup(w){const P=G(),b=ee(),u=N(w,"dialog"),n=N(w,"permission"),f=w,{handleSubmit:C}=ue({validationSchema:{name:"required"}}),m=me("name"),p=v(!1),h=v(!1);te(u,c=>{c&&n.value?(m.setValue(n.value.name),h.value=!1):(n.value=null,m.resetField(),h.value=!0)});const d=C(async c=>{p.value=!0;try{var s=await fetch(g.permissionCreate.url,{method:g.permissionCreate.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(c)});s=await s.json(),b.notify(s.message,"success"),u.value=!1,f.reloadFunction()}catch(_){console.log(_)}finally{p.value=!1}}),r=C(async c=>{var _;p.value=!0;try{const y=(_=n.value)==null?void 0:_.id;var s=await fetch(`${g.permissionUpdate.url}?permission_id=${y}`,{method:g.permissionUpdate.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(c)});s=await s.json(),b.notify(s.message,"success"),u.value=!1,f.reloadFunction()}catch(y){console.log(y)}finally{p.value=!1}});return(c,s)=>{const _=i("v-btn"),y=i("v-card-title"),x=i("v-divider"),k=i("v-text-field"),A=i("v-card-text"),S=i("v-card-actions"),O=i("v-card"),B=i("v-form"),E=i("v-dialog");return U(),M(E,{modelValue:u.value,"onUpdate:modelValue":s[4]||(s[4]=$=>u.value=$),"max-width":"400",persistent:p.value},{default:l(()=>[a(B,{onSubmit:s[3]||(s[3]=ve($=>h.value?o(d)():o(r)(),["prevent"]))},{default:l(()=>[a(O,{loading:p.value,rounded:"lg"},{default:l(()=>[a(y,{class:"d-flex justify-space-between align-center"},{default:l(()=>[V("div",{textContent:T(h.value?"Create new permission":"Edit permission")},null,8,Ce),a(_,{icon:"$close",variant:"text",onClick:s[0]||(s[0]=$=>u.value=!1),disabled:p.value},null,8,["disabled"])]),_:1}),a(x,{class:"mb-4"}),a(A,null,{default:l(()=>[a(k,{"prepend-inner-icon":o(ce),modelValue:o(m).value.value,"onUpdate:modelValue":s[1]||(s[1]=$=>o(m).value.value=$),"error-messages":o(m).errorMessage.value,label:"Name",variant:"outlined",clearable:"","persistent-clear":"",disabled:p.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),a(x),a(S,{class:"ma-2"},{default:l(()=>[a(_,{type:"button",text:"Cancel",onClick:s[2]||(s[2]=$=>u.value=!1),disabled:p.value},null,8,["disabled"]),a(_,{type:"submit",color:h.value?"success":"primary",variant:"flat",text:h.value?"Create":"Update",loading:p.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1},8,["modelValue","persistent"])}}},Ue={__name:"PermissionDeleteDialog",props:Z({reloadFunction:{}},{dialog:{},dialogModifiers:{},permission:{},permissionModifiers:{},permissions:{},permissionsModifiers:{}}),emits:["update:dialog","update:permission","update:permissions"],setup(w){const P=G(),b=ee(),u=N(w,"dialog"),n=N(w,"permission"),f=N(w,"permissions"),C=w,m=v(!1);te(u,d=>{d||(n.value=null,f.value.length=0)});async function p(){var r;m.value=!0;try{const c=(r=n.value)==null?void 0:r.id;var d=await fetch(`${g.permissionDelete.url}?permission_id=${c}`,{method:g.permissionDelete.method,headers:{Authorization:P.token}});d=await d.json(),b.notify(d.message,"success"),u.value=!1,C.reloadFunction()}catch(c){console.log(c)}finally{m.value=!1}}async function h(){m.value=!0;try{var d=await fetch(g.permissioneleteMany.url,{method:g.permissioneleteMany.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(f.value)});d=await d.json(),b.notify(d.message,"success"),u.value=!1,C.reloadFunction()}catch(r){console.log(r)}finally{m.value=!1}}return(d,r)=>{const c=i("v-card-text"),s=i("v-btn"),_=i("v-card-actions"),y=i("v-card"),x=i("v-dialog");return U(),M(x,{modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=k=>u.value=k),"max-width":"400",persistent:m.value},{default:l(()=>[a(y,{title:`Delete ${n.value?"Permission":"Permissions"}`,loading:m.value,rounded:"lg"},{default:l(()=>[a(c,null,{default:l(()=>[I(" Are you sure you want to delete "+T(n.value?"this permission":"the selected permissions")+"? ",1)]),_:1}),a(_,{class:"ma-2"},{default:l(()=>[a(s,{text:"Cancel",onClick:r[0]||(r[0]=k=>u.value=!1),disabled:m.value},null,8,["disabled"]),a(s,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:r[1]||(r[1]=k=>n.value?p():h()),loading:m.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},Pe={class:"mb-5"},De={class:"d-flex align-center ga-2 opacity-80"},Ve=["textContent"],Me={class:"d-flex ga-2 align-center"},Ae={class:"text-no-wrap"},Se={class:"text-no-wrap"},ze={class:"text-no-wrap"},Te={__name:"PermissionListView",setup(w){const P=_e(),b=G(),u=pe(),n=ye(),f=v(!1),C=v([]),m=v(0),p=v(0),h=v(""),d=v(1),r=v(10),c=v([{key:"updated_at",order:"desc"}]),s=v(),_=v([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"Name",key:"name"},{title:"Roles",key:"roles",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"}]);async function y(){var j,F,H,J;f.value=!0;try{var D={page:d.value,limit:r.value,query:h.value,roles:s.value?s.value.join(","):"",sort_by:(j=c.value.at(0))==null?void 0:j.key,sort_order:(F=c.value.at(0))==null?void 0:F.order};D=new URLSearchParams(D);const L=`${g.permissionList.url}?${D.toString()}`;var t=await fetch(L,{method:g.permissionList.method,headers:{Authorization:b.token}});t=await t.json(),C.value=t==null?void 0:t.data,m.value=(H=t==null?void 0:t.pagination)==null?void 0:H.total,p.value=(J=t==null?void 0:t.pagination)==null?void 0:J.filtered}catch(L){console.log(L)}finally{f.value=!1}}fe(()=>{b.isLoggedIn&&y()});const x=v(),k=v([]),A=v(!1),S=v(!1),O=b.isAuthorized(g.permissionCreate.permission),B=b.isAuthorized(g.permissionUpdate.permission),E=b.isAuthorized(g.permissionDelete.permission),$=b.isAuthorized(g.permissioneleteMany.permission),ae=X([B,E]),K=X([$]);ae||_.value.shift();function oe(){x.value=null,A.value=!0}function se(D){x.value=D,A.value=!0}function ie(D){x.value=D,S.value=!0}function ne(){S.value=!0}return(D,t)=>{const j=i("v-icon"),F=i("v-col"),H=i("v-row"),J=i("v-divider"),L=i("v-btn"),R=i("v-tooltip"),le=i("v-chip"),re=i("v-data-table-server");return U(),Q(W,null,[V("div",Pe,[V("h1",De,[a(j,{icon:o(P).meta.icon,size:"x-small"},null,8,["icon"]),V("span",{textContent:T(o(P).meta.title)},null,8,Ve)])]),a(H,{align:"center",justify:"start",class:"mb-2",dense:""},{default:l(()=>[a(F,{cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[V("div",Me,[a(j,{icon:"$filter",color:"medium-emphasis"}),a(he,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e)},null,8,["modelValue"])])]),_:1}),a(F,{cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[a(we,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),density:"compact",rounded:"pill","hide-details":"","items-visibility-count":1},null,8,["modelValue"])]),_:1})]),_:1}),a(be,{headers:o(n).data.permissionHeaders,"onUpdate:headers":t[2]||(t[2]=e=>o(n).data.permissionHeaders=e),density:o(n).data.permissionDensity,"onUpdate:density":t[3]||(t[3]=e=>o(n).data.permissionDensity=e),"is-loading":f.value,"refresh-action":y,columns:_.value},{prepend:l(()=>[o(K)?(U(),Q(W,{key:0},[o($)&&k.value.length>0?(U(),M(q,{key:0,"tooltip-label":"Delete selected permissions","is-loading":f.value,onClick:ne,icon:"$delete",size:"default","change-color-on-hover":!1},null,8,["is-loading"])):z("",!0),k.value.length>0?(U(),M(J,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):z("",!0)],64)):z("",!0),o(O)?(U(),M(R,{key:1,text:"Create new role","open-on-click":""},{activator:l(({props:e})=>[a(L,ge({icon:"$plus",onClick:oe},e,{disabled:f.value}),null,16,["disabled"])]),_:1})):z("",!0)]),_:1},8,["headers","density","is-loading","columns"]),a(re,{"loading-text":"loading permissions...",headers:o(n).data.permissionHeaders,density:o(n).data.permissionDensity,items:C.value,"items-length":p.value,modelValue:k.value,"onUpdate:modelValue":t[6]||(t[6]=e=>k.value=e),page:d.value,"onUpdate:page":t[7]||(t[7]=e=>d.value=e),"items-per-page":r.value,"onUpdate:itemsPerPage":t[8]||(t[8]=e=>r.value=e),"sort-by":c.value,"onUpdate:sortBy":t[9]||(t[9]=e=>c.value=e),loading:f.value,"onUpdate:options":y,"disable-sort":f.value,"must-sort":"",hover:"","show-select":o(K),"header-props":{class:"text-no-wrap"}},{"item.actions":l(({item:e})=>[V("div",Ae,[o(B)?(U(),M(q,{key:0,"tooltip-label":"Edit","is-loading":f.value,onClick:de=>se(e),icon:"$edit",density:o(n).data.permissionDensity},null,8,["is-loading","onClick","density"])):z("",!0),o(E)&&!e.deleted?(U(),M(q,{key:1,"tooltip-label":"Delete","is-loading":f.value,onClick:de=>ie(e),icon:"$delete","color-on-hover":"red",density:o(n).data.permissionDensity},null,8,["is-loading","onClick","density"])):z("",!0)])]),"item.roles":l(({value:e})=>[a(xe,{items:e,"item-key":"id","title-key":"name","color-key":"color",label:"role",density:o(n).data.permissionDensity},null,8,["items","density"])]),"item.name":l(({value:e})=>[a(le,{class:"text-no-wrap font-weight-medium",density:o(n).data.permissionDensity,text:e},null,8,["density","text"])]),"item.created_at":l(({value:e})=>[V("span",Se,[I(T(o(Y)(e))+" ",1),a(R,{activator:"parent",text:o(u).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.updated_at":l(({value:e})=>[V("span",ze,[I(T(o(Y)(e))+" ",1),a(R,{activator:"parent",text:o(u).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),bottom:l(()=>[a(ke,{class:"mt-2",page:d.value,"onUpdate:page":t[4]||(t[4]=e=>d.value=e),"items-per-page":r.value,"onUpdate:itemsPerPage":t[5]||(t[5]=e=>r.value=e),"items-count":C.value.length,total:m.value,filtered:p.value,label:"permissions"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","density","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),a($e,{dialog:A.value,"onUpdate:dialog":t[10]||(t[10]=e=>A.value=e),permission:x.value,"onUpdate:permission":t[11]||(t[11]=e=>x.value=e),"reload-function":y},null,8,["dialog","permission"]),a(Ue,{dialog:S.value,"onUpdate:dialog":t[12]||(t[12]=e=>S.value=e),permission:x.value,"onUpdate:permission":t[13]||(t[13]=e=>x.value=e),permissions:k.value,"onUpdate:permissions":t[14]||(t[14]=e=>k.value=e),"reload-function":y},null,8,["dialog","permission","permissions"])],64)}}};export{Te as default};
