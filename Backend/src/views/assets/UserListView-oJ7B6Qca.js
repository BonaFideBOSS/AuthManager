import{E as ue,a as le,p as ie,G,r as v,q as ge,s as O,H as de,e as b,o as w,c as X,d as e,w as s,C as _e,b as k,t as I,u as l,k as R,l as q,D as ye,y as be,z as Ue,F as te,f as n,n as ae,I as xe,J as ke,K as we,L as Ve,M as W,g as he,h as $e}from"./index-DtMPFWy0.js";import{c as se,t as ne}from"./index-zKOuXdVJ.js";import{_ as Ce,a as De,b as Me}from"./AutoComplete-DQs9QBIP.js";import{_ as Ae}from"./AvatarSelectorDialog-QQbinys-.js";import{_ as re}from"./RoleSelectField-BGGyT3Dq.js";const Le=["textContent"],ze={__name:"UserDialog",props:ue({reloadFunction:{}},{dialog:{},dialogModifiers:{},user:{},userModifiers:{}}),emits:["update:dialog","update:user"],setup(C){const N=le(),V=ie(),m=G(C,"dialog"),d=G(C,"user"),h=v(!1),D=C,{handleSubmit:g,handleReset:P,setValues:E}=ge({validationSchema:{email:"required|email",username:"required|min:4,max:16",password:"required|min:6"}}),c=O("avatar"),r=O("username"),f=O("email"),U=O("password"),x=O("deleted"),M=O("roles"),i=v(!1),p=v(!1);de(m,_=>{_&&d.value?(E(d.value),M.setValue(d.value.roles.map(o=>o.id)),p.value=!1):(d.value=null,P(),M.resetField({value:[]}),p.value=!0)});const L=g(async _=>{i.value=!0;try{m.value=!1,D.reloadFunction()}catch(o){console.log(o)}finally{i.value=!1}}),J=g(async _=>{var $;i.value=!0;try{const z=($=d.value)==null?void 0:$.id;var o=await fetch(`${b.userUpdate.url}?user_id=${z}`,{method:b.userUpdate.method,headers:{Authorization:N.token,"Content-Type":"application/json"},body:JSON.stringify(_)});o=await o.json(),V.notify(o.message,"success"),m.value=!1,D.reloadFunction()}catch(z){console.log(z)}finally{i.value=!1}});return(_,o)=>{const $=n("v-btn"),z=n("v-card-title"),H=n("v-divider"),K=n("v-avatar"),S=n("v-col"),Y=n("v-text-field"),Z=n("v-row"),y=n("v-switch"),a=n("v-card-text"),j=n("v-card-actions"),F=n("v-card"),T=n("v-form"),B=n("v-dialog");return w(),X(te,null,[e(B,{modelValue:m.value,"onUpdate:modelValue":o[9]||(o[9]=u=>m.value=u),"max-width":_.$vuetify.display.smAndUp?"600":"",persistent:i.value,fullscreen:!_.$vuetify.display.smAndUp,scrollable:""},{default:s(()=>[e(T,{onSubmit:o[8]||(o[8]=_e(u=>p.value?l(L)():l(J)(),["prevent"]))},{default:s(()=>[e(F,{loading:i.value,rounded:_.$vuetify.display.smAndUp?"lg":"0"},{default:s(()=>[e(z,{class:"d-flex justify-space-between align-center"},{default:s(()=>[k("div",{textContent:I(p.value?"Create new user":"Edit user")},null,8,Le),e($,{icon:"$close",variant:"text",onClick:o[0]||(o[0]=u=>m.value=!1),disabled:i.value},null,8,["disabled"])]),_:1}),e(H),e(a,null,{default:s(()=>[e(Z,{align:"center"},{default:s(()=>[e(S,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:s(()=>[l(c).value.value?(w(),R(K,{key:0,image:`${l(b).userAvatarURL}/${l(c).value.value}`,size:"80"},null,8,["image"])):q("",!0)]),_:1}),e(S,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:s(()=>[e($,{onClick:o[1]||(o[1]=u=>h.value=!0),text:"Change avatar",variant:"tonal",disabled:i.value},null,8,["disabled"])]),_:1}),e(S,{cols:"12",sm:"6"},{default:s(()=>[e(Y,{"prepend-inner-icon":l(ye),modelValue:l(r).value.value,"onUpdate:modelValue":o[2]||(o[2]=u=>l(r).value.value=u),"error-messages":l(r).errorMessage.value,label:"Username",variant:"outlined",disabled:i.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),e(S,{cols:"12",sm:"6"},{default:s(()=>[e(Y,{"prepend-inner-icon":l(be),modelValue:l(f).value.value,"onUpdate:modelValue":o[3]||(o[3]=u=>l(f).value.value=u),"error-messages":l(f).errorMessage.value,label:"Email",variant:"outlined",disabled:i.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),e(S,{cols:"12",sm:"6"},{default:s(()=>[e(Y,{"prepend-inner-icon":l(Ue),modelValue:l(U).value.value,"onUpdate:modelValue":o[4]||(o[4]=u=>l(U).value.value=u),"error-messages":l(U).errorMessage.value,label:"Password",variant:"outlined",disabled:i.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),e(S,{cols:"12",sm:"6"},{default:s(()=>[e(re,{modelValue:l(M).value.value,"onUpdate:modelValue":o[5]||(o[5]=u=>l(M).value.value=u),disabled:i.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(y,{modelValue:l(x).value.value,"onUpdate:modelValue":o[6]||(o[6]=u=>l(x).value.value=u),color:l(x).value.value?"red-accent-4":"",label:`Deleted: ${l(x).value.value?"Yes":"No"}`,"hide-details":"",disabled:i.value},null,8,["modelValue","color","label","disabled"])]),_:1}),e(H),e(j,{class:"ma-2"},{default:s(()=>[e($,{type:"button",text:"Cancel",onClick:o[7]||(o[7]=u=>m.value=!1),disabled:i.value},null,8,["disabled"]),e($,{type:"submit",color:p.value?"success":"primary",variant:"flat",text:p.value?"Create":"Update",loading:i.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"]),e(Ae,{dialog:h.value,"onUpdate:dialog":o[10]||(o[10]=u=>h.value=u),avatar:l(c).value.value,"onUpdate:avatar":o[11]||(o[11]=u=>l(c).value.value=u)},null,8,["dialog","avatar"])],64)}}},Se={__name:"UserDeleteDialog",props:ue({reloadFunction:{}},{dialog:{},dialogModifiers:{},user:{},userModifiers:{},users:{default:[]},usersModifiers:{}}),emits:["update:dialog","update:user","update:users"],setup(C){const N=le(),V=ie(),m=G(C,"dialog"),d=G(C,"user"),h=G(C,"users"),D=C,g=v(!1);de(m,c=>{c||(d.value=null,h.value.length=0)});async function P(){var r;g.value=!0;try{const f=(r=d.value)==null?void 0:r.id;var c=await fetch(`${b.userDelete.url}?user_id=${f}`,{method:b.userDelete.method,headers:{Authorization:N.token}});c=await c.json(),V.notify(c.message,"success"),m.value=!1,D.reloadFunction()}catch(f){console.log(f)}finally{g.value=!1}}async function E(){g.value=!0;try{var c=await fetch(b.userDeleteMany.url,{method:b.userDeleteMany.method,headers:{Authorization:N.token,"Content-Type":"application/json"},body:JSON.stringify(h.value)});c=await c.json(),V.notify(c.message,"success"),m.value=!1,D.reloadFunction()}catch(r){console.log(r)}finally{g.value=!1}}return(c,r)=>{const f=n("v-card-text"),U=n("v-btn"),x=n("v-card-actions"),M=n("v-card"),i=n("v-dialog");return w(),R(i,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=p=>m.value=p),"max-width":"400",persistent:g.value},{default:s(()=>[e(M,{title:`Delete ${d.value?"User":"Users"}`,loading:g.value,rounded:"lg"},{default:s(()=>[e(f,null,{default:s(()=>[ae(" Are you sure you want to delete "+I(d.value?"this user":"the selected users")+"? ",1)]),_:1}),e(x,{class:"ma-2"},{default:s(()=>[e(U,{text:"Cancel",onClick:r[0]||(r[0]=p=>m.value=!1),disabled:g.value},null,8,["disabled"]),e(U,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:r[1]||(r[1]=p=>d.value?P():E()),loading:g.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},je={class:"mb-5"},Fe={class:"d-flex align-center ga-2 opacity-80"},Ne=["textContent"],Pe={class:"d-flex ga-2 align-center"},Ee={class:"text-no-wrap"},Re={class:"text-no-wrap"},Te=["textContent"],Be={class:"d-flex flex-wrap ga-1 my-1"},Oe={key:0},qe={class:"text-no-wrap"},Ie={class:"text-no-wrap"},Qe={__name:"UserListView",setup(C){const N=$e(),V=le(),m=xe(),d=v(!1),h=v([]),D=v([]),g=v(0),P=v(0),E=v(""),c=v(!0),r=v(),f=v(1),U=v(10),x=v([{key:"updated_at",order:"desc"}]),M=v([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"User",key:"username",value:y=>({avatar:y.avatar,username:y.username})},{title:"Email",key:"email"},{title:"Roles",key:"roles",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"},{title:"Deleted",key:"deleted"}]);async function i(){var j,F,T,B;d.value=!0;try{var y={page:f.value,limit:U.value,query:E.value,exclude_deleted:c.value,roles:r.value?r.value.join(","):"",sort_by:(j=x.value.at(0))==null?void 0:j.key,sort_order:(F=x.value.at(0))==null?void 0:F.order};y=new URLSearchParams(y);const u=`${b.userList.url}?${y.toString()}`;var a=await fetch(u,{method:b.userList.method,headers:{Authorization:V.token}});a=await a.json(),D.value=a==null?void 0:a.data,g.value=(T=a==null?void 0:a.pagination)==null?void 0:T.total,P.value=(B=a==null?void 0:a.pagination)==null?void 0:B.filtered}catch(u){console.log(u)}finally{d.value=!1}}ke(()=>{V.isLoggedIn&&i()});const p=v(null),L=v([]),J=v(!1),_=v(!1),o=V.isAuthorized(b.userUpdate.permission),$=V.isAuthorized(b.userDelete.permission),z=V.isAuthorized(b.userDeleteMany.permission),H=se([o,$]),K=se([z]);H||M.value.shift();function S(y){p.value=y,J.value=!0}function Y(y){p.value=y,_.value=!0}function Z(){_.value=!0}return(y,a)=>{const j=n("v-icon"),F=n("v-col"),T=n("v-select"),B=n("v-row"),u=n("v-btn"),Q=n("v-tooltip"),ve=n("v-divider"),oe=n("v-hover"),ce=n("v-avatar"),me=n("v-chip"),pe=n("v-data-table-server");return w(),X(te,null,[k("div",je,[k("h1",Fe,[e(j,{icon:l(N).meta.icon,size:"x-small"},null,8,["icon"]),k("span",{textContent:I(l(N).meta.title)},null,8,Ne)])]),e(B,{align:"center",justify:"start",class:"mb-2",dense:""},{default:s(()=>[e(F,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[k("div",Pe,[e(j,{icon:"$filter",color:"medium-emphasis"}),e(De,{modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=t=>E.value=t)},null,8,["modelValue"])])]),_:1}),e(F,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[e(T,{"prepend-inner-icon":l(Ve),modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=t=>c.value=t),label:"Show Deleted Users",items:[{label:"Yes",key:!1},{label:"No",key:!0}],"item-title":"label","item-value":"key",variant:"outlined",density:"compact",rounded:"pill","hide-details":""},null,8,["prepend-inner-icon","modelValue"])]),_:1}),e(F,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[e(re,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=t=>r.value=t),density:"compact",rounded:"pill","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ce,{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=t=>h.value=t),"is-loading":d.value,"refresh-action":i,columns:M.value},we({_:2},[l(K)?{name:"prepend",fn:s(()=>[l(z)&&L.value.length>0?(w(),R(Q,{key:0,"open-on-click":"",text:"Delete selected users"},{activator:s(({props:t})=>[e(u,W({disabled:d.value,icon:"$delete",onClick:Z},t),null,16,["disabled"])]),_:1})):q("",!0),L.value.length>0?(w(),R(ve,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):q("",!0)]),key:"0"}:void 0]),1032,["modelValue","is-loading","columns"]),e(pe,{"loading-text":"loading users...",headers:h.value,items:D.value,"items-length":P.value,modelValue:L.value,"onUpdate:modelValue":a[6]||(a[6]=t=>L.value=t),page:f.value,"onUpdate:page":a[7]||(a[7]=t=>f.value=t),"items-per-page":U.value,"onUpdate:itemsPerPage":a[8]||(a[8]=t=>U.value=t),"sort-by":x.value,"onUpdate:sortBy":a[9]||(a[9]=t=>x.value=t),loading:d.value,"onUpdate:options":i,"disable-sort":d.value,"must-sort":"",hover:"","show-select":l(K),"header-props":{class:"text-no-wrap"}},{"item.actions":s(({item:t})=>[k("div",Ee,[l(o)?(w(),R(oe,{key:0},{default:s(({isHovering:A,props:ee})=>[e(u,W({disabled:d.value},ee,{color:A?"primary":"",icon:"$edit",onClick:fe=>S(t),variant:"text",size:"small"}),null,16,["disabled","color","onClick"])]),_:2},1024)):q("",!0),l($)&&!t.deleted?(w(),R(oe,{key:1},{default:s(({isHovering:A,props:ee})=>[e(u,W({disabled:d.value},ee,{icon:"$delete",onClick:fe=>Y(t),variant:"text",color:A?"red-accent-4":"",size:"small"}),null,16,["disabled","onClick","color"])]),_:2},1024)):q("",!0)])]),"item.username":s(({value:t})=>[k("div",Re,[e(ce,{image:`${l(b).userAvatarURL}/${t.avatar}`,start:""},null,8,["image"]),k("span",{class:"font-weight-medium",textContent:I(t.username)},null,8,Te)])]),"item.roles":s(({value:t})=>[k("div",Be,[(w(!0),X(te,null,he(t,A=>(w(),R(me,{key:A.id,color:A.color,density:"compact",text:A.name},null,8,["color","text"]))),128)),t.length==0?(w(),X("span",Oe,"-")):q("",!0)])]),"item.created_at":s(({value:t})=>[k("span",qe,[ae(I(l(ne)(t))+" ",1),e(Q,{activator:"parent",text:l(m).format(t,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.updated_at":s(({value:t})=>[k("span",Ie,[ae(I(l(ne)(t))+" ",1),e(Q,{activator:"parent",text:l(m).format(t,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.deleted":s(({item:t})=>[e(Q,{"open-on-click":"",text:t.deleted?l(m).format(t.deleted_at,"fullDateTime12h"):"Not deleted"},{activator:s(({props:A})=>[e(j,W(A,{icon:"$delimiter",color:t.deleted?"red":"green",size:"x-small"}),null,16,["color"])]),_:2},1032,["text"])]),bottom:s(()=>[e(Me,{class:"mt-2",page:f.value,"onUpdate:page":a[4]||(a[4]=t=>f.value=t),"items-per-page":U.value,"onUpdate:itemsPerPage":a[5]||(a[5]=t=>U.value=t),"items-count":D.value.length,total:g.value,filtered:P.value,label:"users"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),e(ze,{dialog:J.value,"onUpdate:dialog":a[10]||(a[10]=t=>J.value=t),user:p.value,"onUpdate:user":a[11]||(a[11]=t=>p.value=t),"reload-function":i},null,8,["dialog","user"]),e(Se,{dialog:_.value,"onUpdate:dialog":a[12]||(a[12]=t=>_.value=t),user:p.value,"onUpdate:user":a[13]||(a[13]=t=>p.value=t),users:L.value,"onUpdate:users":a[14]||(a[14]=t=>L.value=t),"reload-function":i},null,8,["dialog","user","users"])],64)}}};export{Qe as default};
