import{D as ie,a as ae,n as le,E as ue,r as d,p as _e,q,G as ge,e as m,o as U,c as H,d as e,w as n,B as ye,b as w,t as K,u as a,i as T,H as R,C as be,x as xe,y as Ue,F as Q,f as s,j as te,I as Ve,J as he,K as we,L as G,g as ke,h as $e}from"./index-DCvpsAOR.js";import{c as ne,t as se}from"./index-zKOuXdVJ.js";import{_ as Ce,a as De}from"./AutoComplete-C4sy47BO.js";import{_ as Ae}from"./AvatarSelectorDialog-DCevlUQn.js";import{_ as de}from"./RoleSelectField-BG0TnPOG.js";const je=["textContent"],Le={__name:"UserDialog",props:ie({user:{default:null},reloadFunction:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const P=ae(),V=le(),p=ue(B,"modelValue"),k=d(!1),u=B,{handleSubmit:L,handleReset:D,setValues:v}=_e({validationSchema:{email:"required|email",username:"required|min:4,max:16",password:"required|min:6"}}),f=q("avatar"),$=q("username"),C=q("email"),h=q("password"),y=q("deleted"),b=q("roles"),c=d(!1),_=d(!1);ge(p,g=>{g&&u.user?(v(u.user),b.setValue(u.user.roles.map(l=>l.id)),_.value=!1):(D(),b.resetField({value:[]}),_.value=!0)});const E=L(async g=>{c.value=!0;try{var l=await fetch(m.userCreate.url,{method:m.userCreate.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(g)});l=await l.json(),V.notify(l.message,"success"),p.value=!1,u.reloadFunction()}catch(x){console.log(x)}finally{c.value=!1}}),M=L(async g=>{var x;c.value=!0;try{const z=(x=u.user)==null?void 0:x.id;var l=await fetch(`${m.userUpdate.url}?user_id=${z}`,{method:m.userUpdate.method,headers:{Authorization:P.token,"Content-Type":"application/json"},body:JSON.stringify(g)});l=await l.json(),V.notify(l.message,"success"),p.value=!1,u.reloadFunction()}catch(z){console.log(z)}finally{c.value=!1}});return(g,l)=>{const x=s("v-btn"),z=s("v-card-title"),J=s("v-divider"),W=s("v-avatar"),A=s("v-col"),I=s("v-text-field"),X=s("v-row"),Z=s("v-switch"),r=s("v-card-text"),o=s("v-card-actions"),S=s("v-card"),N=s("v-form"),O=s("v-dialog");return U(),H(Q,null,[e(O,{modelValue:p.value,"onUpdate:modelValue":l[9]||(l[9]=i=>p.value=i),"max-width":g.$vuetify.display.smAndUp?"600":"",persistent:c.value,fullscreen:!g.$vuetify.display.smAndUp,scrollable:""},{default:n(()=>[e(N,{onSubmit:l[8]||(l[8]=ye(i=>_.value?a(E)():a(M)(),["prevent"]))},{default:n(()=>[e(S,{loading:c.value,rounded:g.$vuetify.display.smAndUp?"lg":"0"},{default:n(()=>[e(z,{class:"d-flex justify-space-between align-center"},{default:n(()=>[w("div",{textContent:K(_.value?"Create new user":"Edit user")},null,8,je),e(x,{icon:"$close",variant:"text",onClick:l[0]||(l[0]=i=>p.value=!1),disabled:c.value},null,8,["disabled"])]),_:1}),e(J),e(r,null,{default:n(()=>[e(X,{align:"center"},{default:n(()=>[e(A,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:n(()=>[a(f).value.value?(U(),T(W,{key:0,image:`${a(m).userAvatarURL}/${a(f).value.value}`,size:"80"},null,8,["image"])):R("",!0)]),_:1}),e(A,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:n(()=>[e(x,{onClick:l[1]||(l[1]=i=>k.value=!0),text:"Change avatar",variant:"tonal",disabled:c.value},null,8,["disabled"])]),_:1}),e(A,{cols:"12",sm:"6"},{default:n(()=>[e(I,{"prepend-inner-icon":a(be),modelValue:a($).value.value,"onUpdate:modelValue":l[2]||(l[2]=i=>a($).value.value=i),"error-messages":a($).errorMessage.value,label:"Username",variant:"outlined",disabled:c.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),e(A,{cols:"12",sm:"6"},{default:n(()=>[e(I,{"prepend-inner-icon":a(xe),modelValue:a(C).value.value,"onUpdate:modelValue":l[3]||(l[3]=i=>a(C).value.value=i),"error-messages":a(C).errorMessage.value,label:"Email",variant:"outlined"},null,8,["prepend-inner-icon","modelValue","error-messages"])]),_:1}),e(A,{cols:"12",sm:"6"},{default:n(()=>[e(I,{"prepend-inner-icon":a(Ue),modelValue:a(h).value.value,"onUpdate:modelValue":l[4]||(l[4]=i=>a(h).value.value=i),"error-messages":a(h).errorMessage.value,label:"Password",variant:"outlined",disabled:c.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),e(A,{cols:"12",sm:"6"},{default:n(()=>[e(de,{modelValue:a(b).value.value,"onUpdate:modelValue":l[5]||(l[5]=i=>a(b).value.value=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(Z,{modelValue:a(y).value.value,"onUpdate:modelValue":l[6]||(l[6]=i=>a(y).value.value=i),color:a(y).value.value?"red-accent-4":"",label:`Deleted: ${a(y).value.value?"Yes":"No"}`,"hide-details":"",disabled:c.value},null,8,["modelValue","color","label","disabled"])]),_:1}),e(J),e(o,{class:"ma-2"},{default:n(()=>[e(x,{type:"button",text:"Cancel",onClick:l[7]||(l[7]=i=>p.value=!1),disabled:c.value},null,8,["disabled"]),e(x,{type:"submit",color:_.value?"success":"primary",variant:"flat",text:_.value?"Create":"Update",loading:c.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"]),e(Ae,{dialog:k.value,"onUpdate:dialog":l[10]||(l[10]=i=>k.value=i),avatar:a(f).value.value,"onUpdate:avatar":l[11]||(l[11]=i=>a(f).value.value=i)},null,8,["dialog","avatar"])],64)}}},Me={__name:"UserDeleteDialog",props:ie({user:{default:null},reloadFunction:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const P=ae(),V=le(),p=ue(B,"modelValue"),k=B,u=d(!1);async function L(){var v;u.value=!0;try{const f=(v=k.user)==null?void 0:v.id;var D=await fetch(`${m.userDelete.url}?user_id=${f}`,{method:m.userDelete.method,headers:{Authorization:P.token}});D=await D.json(),V.notify(D.message,"success"),p.value=!1,k.reloadFunction()}catch(f){console.log(f)}finally{u.value=!1}}return(D,v)=>{const f=s("v-card-text"),$=s("v-btn"),C=s("v-card-actions"),h=s("v-card"),y=s("v-dialog");return U(),T(y,{modelValue:p.value,"onUpdate:modelValue":v[1]||(v[1]=b=>p.value=b),"max-width":"400",persistent:u.value},{default:n(()=>[e(h,{title:"Delete User",loading:u.value,rounded:"lg"},{default:n(()=>[e(f,null,{default:n(()=>v[2]||(v[2]=[te(" Are you sure you want to delete this user? ")])),_:1}),e(C,{class:"ma-2"},{default:n(()=>[e($,{text:"Cancel",onClick:v[0]||(v[0]=b=>p.value=!1),disabled:u.value},null,8,["disabled"]),e($,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:L,loading:u.value},null,8,["loading"])]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue","persistent"])}}},ze={class:"mb-5"},Se={class:"d-flex align-center ga-2 opacity-80"},Ne=["textContent"],Fe={class:"d-flex ga-2 align-center"},Pe={class:"text-no-wrap"},Re={class:"text-no-wrap"},Te=["textContent"],Be={class:"d-flex flex-wrap ga-1 my-1"},Ee={key:0},Oe={class:"text-no-wrap"},qe={class:"text-no-wrap"},Ke={__name:"UserListView",setup(B){const P=$e(),V=ae(),p=le(),k=Ve(),u=d(!1),L=d([]),D=d(0),v=d(0),f=d(""),$=d(!0),C=d(),h=d(1),y=d(10),b=d([{key:"updated_at",order:"desc"}]),c=d([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"User",key:"username",value:r=>({avatar:r.avatar,username:r.username})},{title:"Email",key:"email"},{title:"Roles",key:"roles",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"},{title:"Deleted",key:"deleted"}]);async function _(){var S,N,O,i;u.value=!0;try{var r={page:h.value,limit:y.value,query:f.value,exclude_deleted:$.value,roles:C.value?C.value.join(","):"",sort_by:(S=b.value.at(0))==null?void 0:S.key,sort_order:(N=b.value.at(0))==null?void 0:N.order};r=new URLSearchParams(r);const F=`${m.userList.url}?${r.toString()}`;var o=await fetch(F,{method:m.userList.method,headers:{Authorization:V.token}});o=await o.json(),L.value=o==null?void 0:o.data,D.value=(O=o==null?void 0:o.pagination)==null?void 0:O.total,v.value=(i=o==null?void 0:o.pagination)==null?void 0:i.filtered}catch(F){console.log(F)}finally{u.value=!1}}he(()=>{V.isLoggedIn&&_()});const E=d({}),M=d([]),g=d(!1),l=d(!1),x=V.isAuthorized(m.userUpdate.permission),z=V.isAuthorized(m.userDelete.permission),J=V.isAuthorized(m.userDeleteMany.permission),W=ne([x,z]),A=ne([J]);W||c.value.shift();function I(r){E.value=r,g.value=!0}function X(r){E.value=r,l.value=!0}async function Z(){u.value=!0;try{var r=await fetch(m.userDeleteMany.url,{method:m.userDeleteMany.method,headers:{Authorization:V.token,"Content-Type":"application/json"},body:JSON.stringify(M.value)});r=await r.json(),p.notify(r.message,"success"),_(),M.value.length=0}catch(o){console.log(o)}finally{u.value=!1}}return(r,o)=>{const S=s("v-icon"),N=s("v-col"),O=s("v-select"),i=s("v-row"),F=s("v-btn"),Y=s("v-tooltip"),re=s("v-divider"),ce=s("v-toolbar"),oe=s("v-hover"),ve=s("v-avatar"),me=s("v-chip"),pe=s("v-data-table-server");return U(),H(Q,null,[w("div",ze,[w("h1",Se,[e(S,{icon:a(P).meta.icon,size:"x-small"},null,8,["icon"]),w("span",{textContent:K(a(P).meta.title)},null,8,Ne)])]),e(i,{align:"center",justify:"start",class:"mb-2",dense:""},{default:n(()=>[e(N,{cols:"12",sm:"6",md:"4",lg:"3"},{default:n(()=>[w("div",Fe,[e(S,{icon:"$filter",color:"medium-emphasis"}),e(Ce,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t)},null,8,["modelValue"])])]),_:1}),e(N,{cols:"12",sm:"6",md:"4",lg:"3"},{default:n(()=>[e(O,{"prepend-inner-icon":a(we),modelValue:$.value,"onUpdate:modelValue":o[1]||(o[1]=t=>$.value=t),label:"Show Deleted Users",items:[{label:"Yes",key:!1},{label:"No",key:!0}],"item-title":"label","item-value":"key",variant:"outlined",density:"compact",rounded:"pill","hide-details":""},null,8,["prepend-inner-icon","modelValue"])]),_:1}),e(N,{cols:"12",sm:"6",md:"4",lg:"3"},{default:n(()=>[e(de,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=t=>C.value=t),density:"compact",rounded:"pill","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(ce,null,{default:n(()=>[a(A)?(U(),H(Q,{key:0},[a(J)&&M.value.length>0?(U(),T(Y,{key:0,text:"Delete selected users"},{activator:n(({props:t})=>[e(F,G({disabled:u.value,icon:"$delete",onClick:Z},t),null,16,["disabled"])]),_:1})):R("",!0),M.value.length>0?(U(),T(re,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):R("",!0)],64)):R("",!0),e(Y,{text:"Refresh"},{activator:n(({props:t})=>[e(F,G({disabled:u.value,icon:"$refresh",onClick:_},t),null,16,["disabled"])]),_:1})]),_:1}),e(pe,{"loading-text":"loading users...",headers:c.value,items:L.value,"items-length":v.value,modelValue:M.value,"onUpdate:modelValue":o[5]||(o[5]=t=>M.value=t),page:h.value,"onUpdate:page":o[6]||(o[6]=t=>h.value=t),"items-per-page":y.value,"onUpdate:itemsPerPage":o[7]||(o[7]=t=>y.value=t),"sort-by":b.value,"onUpdate:sortBy":o[8]||(o[8]=t=>b.value=t),loading:u.value,"onUpdate:options":_,"must-sort":"",hover:"","show-select":a(A),"header-props":{class:"text-no-wrap"}},{"item.actions":n(({item:t})=>[w("div",Pe,[a(x)?(U(),T(oe,{key:0},{default:n(({isHovering:j,props:ee})=>[e(F,G({disabled:u.value},ee,{color:j?"primary":"",icon:"$edit",onClick:fe=>I(t),variant:"text",size:"small"}),null,16,["disabled","color","onClick"])]),_:2},1024)):R("",!0),a(z)&&!t.deleted?(U(),T(oe,{key:1},{default:n(({isHovering:j,props:ee})=>[e(F,G({disabled:u.value},ee,{icon:"$delete",onClick:fe=>X(t),variant:"text",color:j?"red-accent-4":"",size:"small"}),null,16,["disabled","onClick","color"])]),_:2},1024)):R("",!0)])]),"item.username":n(({value:t})=>[w("div",Re,[e(ve,{image:`${a(m).userAvatarURL}/${t.avatar}`,start:""},null,8,["image"]),w("span",{class:"font-weight-medium",textContent:K(t.username)},null,8,Te)])]),"item.roles":n(({value:t})=>[w("div",Be,[(U(!0),H(Q,null,ke(t,j=>(U(),T(me,{key:j.id,color:j.color,density:"compact",text:j.name},null,8,["color","text"]))),128)),t.length==0?(U(),H("span",Ee,"-")):R("",!0)])]),"item.created_at":n(({value:t})=>[w("span",Oe,[te(K(a(se)(t))+" ",1),e(Y,{activator:"parent",text:a(k).format(t,"fullDateTime12h")},null,8,["text"])])]),"item.updated_at":n(({value:t})=>[w("span",qe,[te(K(a(se)(t))+" ",1),e(Y,{activator:"parent",text:a(k).format(t,"fullDateTime12h")},null,8,["text"])])]),"item.deleted":n(({item:t})=>[e(Y,{text:t.deleted?a(k).format(t.deleted_at,"fullDateTime12h"):"Not deleted"},{activator:n(({props:j})=>[e(S,G(j,{icon:"$delimiter",color:t.deleted?"red":"green",size:"x-small"}),null,16,["color"])]),_:2},1032,["text"])]),bottom:n(()=>[e(De,{class:"mt-2",page:h.value,"onUpdate:page":o[3]||(o[3]=t=>h.value=t),"items-per-page":y.value,"onUpdate:itemsPerPage":o[4]||(o[4]=t=>y.value=t),"items-count":L.value.length,total:D.value,filtered:v.value,label:"users"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","show-select"]),e(Le,{modelValue:g.value,"onUpdate:modelValue":o[9]||(o[9]=t=>g.value=t),user:E.value,"reload-function":_},null,8,["modelValue","user"]),e(Me,{modelValue:l.value,"onUpdate:modelValue":o[10]||(o[10]=t=>l.value=t),user:E.value,"reload-function":_},null,8,["modelValue","user"])],64)}}};export{Ke as default};
