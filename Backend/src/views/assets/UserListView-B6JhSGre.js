import{E as oe,a as ae,p as se,G as J,r as m,q as ve,s as B,H as ne,e as U,o as h,c as Q,d as a,w as s,C as ce,b as $,t as E,u as t,k as O,l as I,D as me,y as pe,z as fe,F as ie,f as n,n as W,I as ge,J as _e,K as ye,L as be,M as Ue,h as xe}from"./index-8bYaaTru.js";import{p as ke,_ as we,a as Ve,b as ee,c as $e,d as he}from"./AutoComplete-BcJ8ShvW.js";import{c as le,t as te}from"./index-zKOuXdVJ.js";import{_ as De}from"./AvatarSelectorDialog-FAio8iRU.js";import{_ as de}from"./RoleSelectField-BRxTpbs4.js";const Ce=["textContent"],Me={__name:"UserDialog",props:oe({reloadFunction:{}},{dialog:{},dialogModifiers:{},user:{},userModifiers:{}}),emits:["update:dialog","update:user"],setup(D){const F=ae(),w=se(),v=J(D,"dialog"),u=J(D,"user"),f=m(!1),C=D,{handleSubmit:_,handleReset:N,setValues:P}=ve({validationSchema:{email:"required|email",username:"required|min:4,max:16",password:"min:6"}}),c=B("avatar"),r=B("username"),g=B("email"),x=B("password"),k=B("deleted"),M=B("roles"),d=m(!1),p=m(!1);ne(v,y=>{y&&u.value?(P(u.value),M.setValue(u.value.roles.map(o=>o.id)),p.value=!1):(u.value=null,N(),M.resetField({value:[]}),p.value=!0)});const A=_(async y=>{d.value=!0;try{v.value=!1,C.reloadFunction()}catch(o){console.log(o)}finally{d.value=!1}}),q=_(async y=>{var V;d.value=!0;try{const L=(V=u.value)==null?void 0:V.id;var o=await fetch(`${U.userUpdate.url}?user_id=${L}`,{method:U.userUpdate.method,headers:{Authorization:F.token,"Content-Type":"application/json"},body:JSON.stringify(y)});o=await o.json(),w.notify(o.message,"success"),v.value=!1,C.reloadFunction()}catch(L){console.log(L)}finally{d.value=!1}});return(y,o)=>{const V=n("v-btn"),L=n("v-card-title"),Y=n("v-divider"),G=n("v-avatar"),S=n("v-col"),H=n("v-text-field"),X=n("v-row"),b=n("v-switch"),l=n("v-card-text"),z=n("v-card-actions"),j=n("v-card"),T=n("v-form"),R=n("v-dialog");return h(),Q(ie,null,[a(R,{modelValue:v.value,"onUpdate:modelValue":o[9]||(o[9]=i=>v.value=i),"max-width":y.$vuetify.display.smAndUp?"600":"",persistent:d.value,fullscreen:!y.$vuetify.display.smAndUp,scrollable:""},{default:s(()=>[a(T,{onSubmit:o[8]||(o[8]=ce(i=>p.value?t(A)():t(q)(),["prevent"]))},{default:s(()=>[a(j,{loading:d.value,rounded:y.$vuetify.display.smAndUp?"lg":"0"},{default:s(()=>[a(L,{class:"d-flex justify-space-between align-center"},{default:s(()=>[$("div",{textContent:E(p.value?"Create new user":"Edit user")},null,8,Ce),a(V,{icon:"$close",variant:"text",onClick:o[0]||(o[0]=i=>v.value=!1),disabled:d.value},null,8,["disabled"])]),_:1}),a(Y),a(l,null,{default:s(()=>[a(X,{align:"center"},{default:s(()=>[a(S,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:s(()=>[t(c).value.value?(h(),O(G,{key:0,image:`${t(U).userAvatarURL}/${t(c).value.value}`,size:"80"},null,8,["image"])):I("",!0)]),_:1}),a(S,{cols:"12",sm:"6",class:"d-flex justify-center"},{default:s(()=>[a(V,{onClick:o[1]||(o[1]=i=>f.value=!0),text:"Change avatar",variant:"tonal",disabled:d.value},null,8,["disabled"])]),_:1}),a(S,{cols:"12",sm:"6"},{default:s(()=>[a(H,{"prepend-inner-icon":t(me),modelValue:t(r).value.value,"onUpdate:modelValue":o[2]||(o[2]=i=>t(r).value.value=i),"error-messages":t(r).errorMessage.value,label:"Username",variant:"outlined",disabled:d.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),a(S,{cols:"12",sm:"6"},{default:s(()=>[a(H,{"prepend-inner-icon":t(pe),modelValue:t(g).value.value,"onUpdate:modelValue":o[3]||(o[3]=i=>t(g).value.value=i),"error-messages":t(g).errorMessage.value,label:"Email",variant:"outlined",disabled:d.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),a(S,{cols:"12",sm:"6"},{default:s(()=>[a(H,{"prepend-inner-icon":t(fe),modelValue:t(x).value.value,"onUpdate:modelValue":o[4]||(o[4]=i=>t(x).value.value=i),"error-messages":t(x).errorMessage.value,label:"Password",variant:"outlined",disabled:d.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"])]),_:1}),a(S,{cols:"12",sm:"6"},{default:s(()=>[a(de,{modelValue:t(M).value.value,"onUpdate:modelValue":o[5]||(o[5]=i=>t(M).value.value=i),disabled:d.value,"show-loader":!0},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(b,{modelValue:t(k).value.value,"onUpdate:modelValue":o[6]||(o[6]=i=>t(k).value.value=i),color:t(k).value.value?"red-accent-4":"",label:`Deleted: ${t(k).value.value?"Yes":"No"}`,"hide-details":"",disabled:d.value},null,8,["modelValue","color","label","disabled"])]),_:1}),a(Y),a(z,{class:"ma-2"},{default:s(()=>[a(V,{type:"button",text:"Cancel",onClick:o[7]||(o[7]=i=>v.value=!1),disabled:d.value},null,8,["disabled"]),a(V,{type:"submit",color:p.value?"success":"primary",variant:"flat",text:p.value?"Create":"Update",loading:d.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"]),a(De,{dialog:f.value,"onUpdate:dialog":o[10]||(o[10]=i=>f.value=i),avatar:t(c).value.value,"onUpdate:avatar":o[11]||(o[11]=i=>t(c).value.value=i)},null,8,["dialog","avatar"])],64)}}},Ae={__name:"UserDeleteDialog",props:oe({reloadFunction:{}},{dialog:{},dialogModifiers:{},user:{},userModifiers:{},users:{default:[]},usersModifiers:{}}),emits:["update:dialog","update:user","update:users"],setup(D){const F=ae(),w=se(),v=J(D,"dialog"),u=J(D,"user"),f=J(D,"users"),C=D,_=m(!1);ne(v,c=>{c||(u.value=null,f.value.length=0)});async function N(){var r;_.value=!0;try{const g=(r=u.value)==null?void 0:r.id;var c=await fetch(`${U.userDelete.url}?user_id=${g}`,{method:U.userDelete.method,headers:{Authorization:F.token}});c=await c.json(),w.notify(c.message,"success"),v.value=!1,C.reloadFunction()}catch(g){console.log(g)}finally{_.value=!1}}async function P(){_.value=!0;try{var c=await fetch(U.userDeleteMany.url,{method:U.userDeleteMany.method,headers:{Authorization:F.token,"Content-Type":"application/json"},body:JSON.stringify(f.value)});c=await c.json(),w.notify(c.message,"success"),v.value=!1,C.reloadFunction()}catch(r){console.log(r)}finally{_.value=!1}}return(c,r)=>{const g=n("v-card-text"),x=n("v-btn"),k=n("v-card-actions"),M=n("v-card"),d=n("v-dialog");return h(),O(d,{modelValue:v.value,"onUpdate:modelValue":r[2]||(r[2]=p=>v.value=p),"max-width":"400",persistent:_.value},{default:s(()=>[a(M,{title:`Delete ${u.value?"User":"Users"}`,loading:_.value,rounded:"lg"},{default:s(()=>[a(g,null,{default:s(()=>[W(" Are you sure you want to delete "+E(u.value?"this user":"the selected users")+"? ",1)]),_:1}),a(k,{class:"ma-2"},{default:s(()=>[a(x,{text:"Cancel",onClick:r[0]||(r[0]=p=>v.value=!1),disabled:_.value},null,8,["disabled"]),a(x,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:r[1]||(r[1]=p=>u.value?N():P()),loading:_.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},Le={class:"mb-5"},Se={class:"d-flex align-center ga-2 opacity-80"},ze=["textContent"],je={class:"d-flex ga-2 align-center"},Fe={class:"text-no-wrap"},Ne={class:"text-no-wrap"},Pe=["textContent"],Ee={class:"text-no-wrap"},Te={class:"text-no-wrap"},Re={key:0,class:"text-no-wrap"},Be={key:1},Ye={__name:"UserListView",setup(D){const F=xe(),w=ae(),v=ge(),u=ke(),f=m(!1),C=m([]),_=m(0),N=m(0),P=m(""),c=m(!0),r=m(),g=m(1),x=m(10),k=m([{key:"updated_at",order:"desc"}]),M=m([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"User",key:"username",value:b=>({avatar:b.avatar,username:b.username})},{title:"Email",key:"email"},{title:"Roles",key:"roles",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"},{title:"Last Login",key:"last_login_at"},{title:"Deleted",key:"deleted"}]);async function d(){var z,j,T,R;f.value=!0;try{var b={page:g.value,limit:x.value,query:P.value,exclude_deleted:c.value,roles:r.value?r.value.join(","):"",sort_by:(z=k.value.at(0))==null?void 0:z.key,sort_order:(j=k.value.at(0))==null?void 0:j.order};b=new URLSearchParams(b);const i=`${U.userList.url}?${b.toString()}`;var l=await fetch(i,{method:U.userList.method,headers:{Authorization:w.token}});l=await l.json(),C.value=l==null?void 0:l.data,_.value=(T=l==null?void 0:l.pagination)==null?void 0:T.total,N.value=(R=l==null?void 0:l.pagination)==null?void 0:R.filtered}catch(i){console.log(i)}finally{f.value=!1}}_e(()=>{w.isLoggedIn&&d()});const p=m(null),A=m([]),q=m(!1),y=m(!1),o=w.isAuthorized(U.userUpdate.permission),V=w.isAuthorized(U.userDelete.permission),L=w.isAuthorized(U.userDeleteMany.permission),Y=le([o,V]),G=le([L]);Y||M.value.shift();function S(b){p.value=b,q.value=!0}function H(b){p.value=b,y.value=!0}function X(){y.value=!0}return(b,l)=>{const z=n("v-icon"),j=n("v-col"),T=n("v-select"),R=n("v-row"),i=n("v-divider"),ue=n("v-avatar"),K=n("v-tooltip"),re=n("v-data-table-server");return h(),Q(ie,null,[$("div",Le,[$("h1",Se,[a(z,{icon:t(F).meta.icon,size:"x-small"},null,8,["icon"]),$("span",{textContent:E(t(F).meta.title)},null,8,ze)])]),a(R,{align:"center",justify:"start",class:"mb-2",dense:""},{default:s(()=>[a(j,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[$("div",je,[a(z,{icon:"$filter",color:"medium-emphasis"}),a(Ve,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value=e)},null,8,["modelValue"])])]),_:1}),a(j,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[a(T,{"prepend-inner-icon":t(be),modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value=e),label:"Show Deleted Users",items:[{label:"Yes",key:!1},{label:"No",key:!0}],"item-title":"label","item-value":"key",variant:"outlined",density:"compact",rounded:"pill","hide-details":""},null,8,["prepend-inner-icon","modelValue"])]),_:1}),a(j,{cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[a(de,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=e=>r.value=e),density:"compact",rounded:"pill","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),a(we,{headers:t(u).data.userHeaders,"onUpdate:headers":l[3]||(l[3]=e=>t(u).data.userHeaders=e),density:t(u).data.userDensity,"onUpdate:density":l[4]||(l[4]=e=>t(u).data.userDensity=e),"is-loading":f.value,"refresh-action":d,columns:M.value},ye({_:2},[t(G)?{name:"prepend",fn:s(()=>[t(L)&&A.value.length>0?(h(),O(ee,{key:0,"tooltip-label":"Delete selected users","is-loading":f.value,onClick:X,icon:"$delete",size:"default","change-color-on-hover":!1},null,8,["is-loading"])):I("",!0),A.value.length>0?(h(),O(i,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):I("",!0)]),key:"0"}:void 0]),1032,["headers","density","is-loading","columns"]),a(re,{"loading-text":"loading users...",headers:t(u).data.userHeaders,density:t(u).data.userDensity,items:C.value,"items-length":N.value,modelValue:A.value,"onUpdate:modelValue":l[7]||(l[7]=e=>A.value=e),page:g.value,"onUpdate:page":l[8]||(l[8]=e=>g.value=e),"items-per-page":x.value,"onUpdate:itemsPerPage":l[9]||(l[9]=e=>x.value=e),"sort-by":k.value,"onUpdate:sortBy":l[10]||(l[10]=e=>k.value=e),loading:f.value,"onUpdate:options":d,"disable-sort":f.value,"must-sort":"",hover:"","show-select":t(G),"header-props":{class:"text-no-wrap"}},{"item.actions":s(({item:e})=>[$("div",Fe,[t(o)?(h(),O(ee,{key:0,"tooltip-label":"Edit","is-loading":f.value,onClick:Z=>S(e),icon:"$edit",density:t(u).data.userDensity},null,8,["is-loading","onClick","density"])):I("",!0),t(V)&&!e.deleted?(h(),O(ee,{key:1,"tooltip-label":"Delete","is-loading":f.value,onClick:Z=>H(e),icon:"$delete","color-on-hover":"red",density:t(u).data.userDensity},null,8,["is-loading","onClick","density"])):I("",!0)])]),"item.username":s(({value:e})=>[$("div",Ne,[a(ue,{image:`${t(U).userAvatarURL}/${e.avatar}`,start:"",density:t(u).data.userDensity},null,8,["image","density"]),$("span",{class:"font-weight-medium",textContent:E(e.username)},null,8,Pe)])]),"item.roles":s(({value:e})=>[a($e,{items:e,"item-key":"id","title-key":"name","color-key":"color",label:"role","display-limit":"2",density:t(u).data.userDensity},null,8,["items","density"])]),"item.created_at":s(({value:e})=>[$("span",Ee,[W(E(t(te)(e))+" ",1),a(K,{activator:"parent",text:t(v).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.updated_at":s(({value:e})=>[$("span",Te,[W(E(t(te)(e))+" ",1),a(K,{activator:"parent",text:t(v).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.last_login_at":s(({value:e})=>[e?(h(),Q("span",Re,[W(E(t(te)(e))+" ",1),a(K,{activator:"parent",text:t(v).format(e,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])):(h(),Q("span",Be,"Never"))]),"item.deleted":s(({item:e})=>[a(K,{"open-on-click":"",text:e.deleted?t(v).format(e.deleted_at,"fullDateTime12h"):"Not deleted"},{activator:s(({props:Z})=>[a(z,Ue(Z,{icon:"$delimiter",color:e.deleted?"red":"green",size:"x-small"}),null,16,["color"])]),_:2},1032,["text"])]),bottom:s(()=>[a(he,{class:"mt-2",page:g.value,"onUpdate:page":l[5]||(l[5]=e=>g.value=e),"items-per-page":x.value,"onUpdate:itemsPerPage":l[6]||(l[6]=e=>x.value=e),"items-count":C.value.length,total:_.value,filtered:N.value,label:"users"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","density","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),a(Me,{dialog:q.value,"onUpdate:dialog":l[11]||(l[11]=e=>q.value=e),user:p.value,"onUpdate:user":l[12]||(l[12]=e=>p.value=e),"reload-function":d},null,8,["dialog","user"]),a(Ae,{dialog:y.value,"onUpdate:dialog":l[13]||(l[13]=e=>y.value=e),user:p.value,"onUpdate:user":l[14]||(l[14]=e=>p.value=e),users:A.value,"onUpdate:users":l[15]||(l[15]=e=>A.value=e),"reload-function":d},null,8,["dialog","user","users"])],64)}}};export{Ye as default};
