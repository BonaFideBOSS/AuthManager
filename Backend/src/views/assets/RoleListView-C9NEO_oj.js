import{E as ne,a as Q,G as B,r as p,o as x,k as A,M as O,u as i,z as ye,e as g,p as ue,q as be,s as le,H as ce,w as a,d as l,b as L,t as S,N as he,O as xe,P as we,Q as ke,C as Ve,f as n,n as T,I as $e,J as Ue,c as ae,F as oe,l as N,g as Ce,h as Re}from"./index-D4rhjMcK.js";import{c as re,t as de}from"./index-zKOuXdVJ.js";import{c as Ae,_ as De,a as Me,b as Pe}from"./AutoComplete-DdV2qJ8V.js";const ve={__name:"PermissionSelectField",props:ne({},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(w){const C=Q(),f=B(w,"modelValue"),v=w,s=p([]);function k(y=1,m=100){var b={page:y,limit:m};b=new URLSearchParams(b).toString(),fetch(`${g.permissionList.url}?${b}`,{headers:{Authorization:C.token}}).then(V=>V.json()).then(V=>{s.value.push(...V.data),V.pagination.filtered>s.value.length&&k(y+1)})}return k(),(y,m)=>(x(),A(Ae,O({"prepend-inner-icon":i(ye),modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=b=>f.value=b),items:s.value,"item-title":"name","item-value":"id",label:"Permissions",variant:"outlined",clearable:"","persistent-clear":"",multiple:!0,"items-visibility-label":"permissions"},v),null,16,["prepend-inner-icon","modelValue","items"]))}},ze=["textContent"],Le={__name:"RoleDialog",props:ne({reloadFunction:{}},{dialog:{},dialogModifiers:{},role:{},roleModifiers:{}}),emits:["update:dialog","update:role"],setup(w){const C=Q(),f=ue(),v=B(w,"dialog"),s=B(w,"role"),k=w,y=["primary","secondary","accent","error","info","success","warning"],{handleSubmit:m,handleReset:b,setValues:V}=be({validationSchema:{name:"required",color:`one_of:${y}`,permissions:""}}),r=le("name"),d=le("color"),_=le("permissions"),u=p(!1),$=p(!1);ce(v,c=>{c&&s.value?(V(s.value),_.setValue(s.value.permissions.map(o=>o.id)),$.value=!1):(s.value=null,b(),_.resetField({value:[]}),$.value=!0)});const D=m(async c=>{u.value=!0;try{var o=await fetch(g.roleCreate.url,{method:g.roleCreate.method,headers:{Authorization:C.token,"Content-Type":"application/json"},body:JSON.stringify(c)});o=await o.json(),f.notify(o.message,"success"),v.value=!1,k.reloadFunction()}catch(h){console.log(h)}finally{u.value=!1}}),U=m(async c=>{var h;u.value=!0;try{const j=(h=s.value)==null?void 0:h.id;var o=await fetch(`${g.roleUpdate.url}?role_id=${j}`,{method:g.roleUpdate.method,headers:{Authorization:C.token,"Content-Type":"application/json"},body:JSON.stringify(c)});o=await o.json(),f.notify(o.message,"success"),v.value=!1,k.reloadFunction()}catch(j){console.log(j)}finally{u.value=!1}});return(c,o)=>{const h=n("v-btn"),j=n("v-card-title"),E=n("v-divider"),I=n("v-text-field"),J=n("v-chip"),K=n("v-list-item"),G=n("v-select"),W=n("v-card-text"),X=n("v-card-actions"),Y=n("v-card"),Z=n("v-form"),R=n("v-dialog");return x(),A(R,{modelValue:v.value,"onUpdate:modelValue":o[6]||(o[6]=e=>v.value=e),"max-width":c.$vuetify.display.smAndUp?"400":"",persistent:u.value,fullscreen:!c.$vuetify.display.smAndUp},{default:a(()=>[l(Z,{onSubmit:o[5]||(o[5]=Ve(e=>$.value?i(D)():i(U)(),["prevent"]))},{default:a(()=>[l(Y,{loading:u.value,rounded:c.$vuetify.display.smAndUp?"lg":"0"},{default:a(()=>[l(j,{class:"d-flex justify-space-between align-center"},{default:a(()=>[L("div",{textContent:S($.value?"Create new role":"Edit role")},null,8,ze),l(h,{icon:"$close",variant:"text",onClick:o[0]||(o[0]=e=>v.value=!1),disabled:u.value},null,8,["disabled"])]),_:1}),l(E,{class:"mb-4"}),l(W,null,{default:a(()=>[l(I,{"prepend-inner-icon":i(he),modelValue:i(r).value.value,"onUpdate:modelValue":o[1]||(o[1]=e=>i(r).value.value=e),"error-messages":i(r).errorMessage.value,label:"Name",class:"mb-2",variant:"outlined",clearable:"","persistent-clear":"",disabled:u.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"]),l(G,{"prepend-inner-icon":i(xe),modelValue:i(d).value.value,"onUpdate:modelValue":o[2]||(o[2]=e=>i(d).value.value=e),clearable:"","persistent-clear":"",label:"Color",items:y,variant:"outlined",class:"mb-2",disabled:u.value},{item:a(({props:e,item:M})=>[l(K,we(ke(e)),{title:a(()=>[l(J,{class:"font-weight-medium",color:M.value,text:M.title,density:"compact"},null,8,["color","text"])]),_:2},1040)]),selection:a(({item:e})=>[l(J,{class:"font-weight-medium",color:e.value,text:e.title},null,8,["color","text"])]),_:1},8,["prepend-inner-icon","modelValue","disabled"]),l(ve,{modelValue:i(_).value.value,"onUpdate:modelValue":o[3]||(o[3]=e=>i(_).value.value=e),disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),l(E),l(X,{class:"ma-2"},{default:a(()=>[l(h,{type:"button",text:"Cancel",onClick:o[4]||(o[4]=e=>v.value=!1),disabled:u.value},null,8,["disabled"]),l(h,{type:"submit",color:$.value?"success":"primary",variant:"flat",text:$.value?"Create":"Update",loading:u.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"])}}},Se={__name:"RoleDeleteDialog",props:ne({reloadFunction:{}},{dialog:{},dialogModifiers:{},role:{},roleModifiers:{},roles:{default:[]},rolesModifiers:{}}),emits:["update:dialog","update:role","update:roles"],setup(w){const C=Q(),f=ue(),v=B(w,"dialog"),s=B(w,"role"),k=B(w,"roles"),y=w,m=p(!1);ce(v,r=>{r||(s.value=null,k.value.length=0)});async function b(){var d;m.value=!0;try{const _=(d=s.value)==null?void 0:d.id;var r=await fetch(`${g.roleDelete.url}?role_id=${_}`,{method:g.roleDelete.method,headers:{Authorization:C.token}});r=await r.json(),f.notify(r.message,"success"),v.value=!1,y.reloadFunction()}catch(_){console.log(_)}finally{m.value=!1}}async function V(){m.value=!0;try{var r=await fetch(g.roleDeleteMany.url,{method:g.roleDeleteMany.method,headers:{Authorization:C.token,"Content-Type":"application/json"},body:JSON.stringify(k.value)});r=await r.json(),f.notify(r.message,"success"),v.value=!1,y.reloadFunction()}catch(d){console.log(d)}finally{m.value=!1}}return(r,d)=>{const _=n("v-card-text"),u=n("v-btn"),$=n("v-card-actions"),D=n("v-card"),U=n("v-dialog");return x(),A(U,{modelValue:v.value,"onUpdate:modelValue":d[2]||(d[2]=c=>v.value=c),"max-width":"400",persistent:m.value},{default:a(()=>[l(D,{title:`Delete ${s.value?"Role":"Roles"}`,loading:m.value,rounded:"lg"},{default:a(()=>[l(_,null,{default:a(()=>[T(" Are you sure you want to delete "+S(s.value?"this role":"the selected roles")+"? ",1)]),_:1}),l($,{class:"ma-2"},{default:a(()=>[l(u,{text:"Cancel",onClick:d[0]||(d[0]=c=>v.value=!1),disabled:m.value},null,8,["disabled"]),l(u,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:d[1]||(d[1]=c=>s.value?b():V()),loading:m.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},je={class:"mb-5"},Fe={class:"d-flex align-center ga-2 opacity-80"},Ne=["textContent"],Oe={class:"d-flex ga-2 align-center"},Te={class:"text-no-wrap"},Be={class:"text-no-wrap"},Ee={class:"text-no-wrap"},Ge={__name:"RoleListView",setup(w){const C=Re(),f=Q(),v=$e(),s=p(!1),k=p([]),y=p([]),m=p(0),b=p(0),V=p(""),r=p(1),d=p(10),_=p([{key:"updated_at",order:"desc"}]),u=p(),$=p([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"Name",key:"name"},{title:"Permissions",key:"permissions",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"}]);async function D(){var M,q,H,F;s.value=!0;try{var R={page:r.value,limit:d.value,query:V.value,perms:u.value?u.value.join(","):"",sort_by:(M=_.value.at(0))==null?void 0:M.key,sort_order:(q=_.value.at(0))==null?void 0:q.order};R=new URLSearchParams(R);const P=`${g.roleList.url}?${R.toString()}`;var e=await fetch(P,{method:g.roleList.method,headers:{Authorization:f.token}});e=await e.json(),y.value=e==null?void 0:e.data,m.value=(H=e==null?void 0:e.pagination)==null?void 0:H.total,b.value=(F=e==null?void 0:e.pagination)==null?void 0:F.filtered}catch(P){console.log(P)}finally{s.value=!1}}Ue(()=>{f.isLoggedIn&&D()});const U=p(),c=p([]),o=p(!1),h=p(!1),j=f.isAuthorized(g.roleCreate.permission),E=f.isAuthorized(g.roleUpdate.permission),I=f.isAuthorized(g.roleDelete.permission),J=f.isAuthorized(g.roleDeleteMany.permission),K=re([E,I]),G=re([J]);K||$.value.shift();function W(){U.value=null,o.value=!0}function X(R){U.value=R,o.value=!0}function Y(R){U.value=R,h.value=!0}function Z(){h.value=!0}return(R,e)=>{const M=n("v-icon"),q=n("v-col"),H=n("v-row"),F=n("v-btn"),P=n("v-tooltip"),me=n("v-divider"),se=n("v-hover"),ee=n("v-chip"),ie=n("v-card-text"),pe=n("v-card"),fe=n("v-menu"),_e=n("v-data-table-server");return x(),ae(oe,null,[L("div",je,[L("h1",Fe,[l(M,{icon:i(C).meta.icon,size:"x-small"},null,8,["icon"]),L("span",{textContent:S(i(C).meta.title)},null,8,Ne)])]),l(H,{align:"center",justify:"start",class:"mb-2",dense:""},{default:a(()=>[l(q,{cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[L("div",Oe,[l(M,{icon:"$filter",color:"medium-emphasis"}),l(Me,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t)},null,8,["modelValue"])])]),_:1}),l(q,{cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[l(ve,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),density:"compact",rounded:"pill","hide-details":"","items-visibility-count":1},null,8,["modelValue"])]),_:1})]),_:1}),l(De,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=t=>k.value=t),"is-loading":s.value,"refresh-action":D,columns:$.value},{prepend:a(()=>[i(G)?(x(),ae(oe,{key:0},[i(J)&&c.value.length>0?(x(),A(P,{key:0,text:"Delete selected roles"},{activator:a(({props:t})=>[l(F,O({disabled:s.value,icon:"$delete",onClick:Z},t),null,16,["disabled"])]),_:1})):N("",!0),c.value.length>0?(x(),A(me,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):N("",!0)],64)):N("",!0),i(j)?(x(),A(P,{key:1,text:"Create new role"},{activator:a(({props:t})=>[l(F,O({icon:"$plus",onClick:W},t,{disabled:s.value}),null,16,["disabled"])]),_:1})):N("",!0)]),_:1},8,["modelValue","is-loading","columns"]),l(_e,{"loading-text":"loading roles...",headers:k.value,items:y.value,"items-length":b.value,modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),page:r.value,"onUpdate:page":e[6]||(e[6]=t=>r.value=t),"items-per-page":d.value,"onUpdate:itemsPerPage":e[7]||(e[7]=t=>d.value=t),"sort-by":_.value,"onUpdate:sortBy":e[8]||(e[8]=t=>_.value=t),loading:s.value,"onUpdate:options":D,"disable-sort":s.value,"must-sort":"",hover:"","show-select":i(G),"header-props":{class:"text-no-wrap"}},{"item.actions":a(({item:t})=>[L("div",Te,[i(E)?(x(),A(se,{key:0},{default:a(({isHovering:z,props:te})=>[l(F,O({disabled:s.value},te,{color:z?"primary":"",icon:"$edit",onClick:ge=>X(t),variant:"text",size:"small"}),null,16,["disabled","color","onClick"])]),_:2},1024)):N("",!0),i(I)?(x(),A(se,{key:1},{default:a(({isHovering:z,props:te})=>[l(F,O({disabled:s.value},te,{color:z?"red-accent-4":"",icon:"$delete",onClick:ge=>Y(t),variant:"text",size:"small"}),null,16,["disabled","color","onClick"])]),_:2},1024)):N("",!0)])]),"item.permissions":a(({value:t})=>[l(fe,{"open-on-hover":""},{activator:a(({props:z})=>[l(ee,O(z,{link:""}),{default:a(()=>[T(S(t.length),1)]),_:2},1040)]),default:a(()=>[l(pe,{"max-width":"300","max-height":"300",rounded:"lg"},{default:a(()=>[l(ie,null,{default:a(()=>[T(S(t.length)+" permissions",1)]),_:2},1024),t.length>0?(x(),A(ie,{key:0,class:"d-flex flex-wrap ga-1 pt-0"},{default:a(()=>[(x(!0),ae(oe,null,Ce(t,z=>(x(),A(ee,{key:z.id},{default:a(()=>[T(S(z.name),1)]),_:2},1024))),128))]),_:2},1024)):N("",!0)]),_:2},1024)]),_:2},1024)]),"item.name":a(({item:t})=>[l(ee,{class:"text-no-wrap font-weight-medium",color:t.color,density:"comfortable",text:t.name},null,8,["color","text"])]),"item.created_at":a(({value:t})=>[L("span",Be,[T(S(i(de)(t))+" ",1),l(P,{activator:"parent",text:i(v).format(t,"fullDateTime12h")},null,8,["text"])])]),"item.updated_at":a(({value:t})=>[L("span",Ee,[T(S(i(de)(t))+" ",1),l(P,{activator:"parent",text:i(v).format(t,"fullDateTime12h")},null,8,["text"])])]),bottom:a(()=>[l(Pe,{class:"mt-2",page:r.value,"onUpdate:page":e[3]||(e[3]=t=>r.value=t),"items-per-page":d.value,"onUpdate:itemsPerPage":e[4]||(e[4]=t=>d.value=t),"items-count":y.value.length,total:m.value,filtered:b.value,label:"roles"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),l(Le,{dialog:o.value,"onUpdate:dialog":e[9]||(e[9]=t=>o.value=t),role:U.value,"onUpdate:role":e[10]||(e[10]=t=>U.value=t),"reload-function":D},null,8,["dialog","role"]),l(Se,{dialog:h.value,"onUpdate:dialog":e[11]||(e[11]=t=>h.value=t),role:U.value,"onUpdate:role":e[12]||(e[12]=t=>U.value=t),roles:c.value,"onUpdate:roles":e[13]||(e[13]=t=>c.value=t),"reload-function":D},null,8,["dialog","role","roles"])],64)}}};export{Ge as default};
