import{D as oe,a as H,E as ne,r as m,o as x,i as C,L as j,u as i,y as ye,e as g,n as se,p as he,q as te,G as be,w as a,d as e,b as z,t as F,M as xe,N as Ve,O as we,P as ke,B as Ce,f as n,j as N,I as $e,J as Ue,c as le,F as ae,H as S,g as Re,h as De}from"./index-DCvpsAOR.js";import{c as de,t as ue}from"./index-zKOuXdVJ.js";import{b as Ae,_ as Pe,a as Le}from"./AutoComplete-C4sy47BO.js";const ce={__name:"PermissionSelectField",props:oe({},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup($){const U=H(),p=ne($,"modelValue"),v=$,_=m([]);function r(V=1,y=100){var d={page:V,limit:y};d=new URLSearchParams(d).toString(),fetch(`${g.permissionList.url}?${d}`,{headers:{Authorization:U.token}}).then(c=>c.json()).then(c=>{_.value.push(...c.data),c.pagination.filtered>_.value.length&&r(V+1)})}return r(),(V,y)=>(x(),C(Ae,j({"prepend-inner-icon":i(ye),modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=d=>p.value=d),items:_.value,"item-title":"name","item-value":"id",label:"Permissions",variant:"outlined",clearable:"","persistent-clear":"",multiple:!0,"items-visibility-label":"permissions"},v),null,16,["prepend-inner-icon","modelValue","items"]))}},ze=["textContent"],Me={__name:"RoleDialog",props:oe({role:{default:null},reloadFunction:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup($){const U=H(),p=se(),v=ne($,"modelValue"),_=$,r=["primary","secondary","accent","error","info","success","warning"],{handleSubmit:V,handleReset:y,setValues:d}=he({validationSchema:{name:"required",color:`one_of:${r}`,permissions:""}}),c=te("name"),k=te("color"),w=te("permissions"),u=m(!1),h=m(!1);be(v,f=>{f&&_.role?(d(_.role),w.setValue(_.role.permissions.map(o=>o.id)),h.value=!1):(y(),w.resetField({value:[]}),h.value=!0)});const M=V(async f=>{u.value=!0;try{var o=await fetch(g.roleCreate.url,{method:g.roleCreate.method,headers:{Authorization:U.token,"Content-Type":"application/json"},body:JSON.stringify(f)});o=await o.json(),p.notify(o.message,"success"),v.value=!1,_.reloadFunction()}catch(b){console.log(b)}finally{u.value=!1}}),A=V(async f=>{var b;u.value=!0;try{const R=(b=_.role)==null?void 0:b.id;var o=await fetch(`${g.roleUpdate.url}?role_id=${R}`,{method:g.roleUpdate.method,headers:{Authorization:U.token,"Content-Type":"application/json"},body:JSON.stringify(f)});o=await o.json(),p.notify(o.message,"success"),v.value=!1,_.reloadFunction()}catch(R){console.log(R)}finally{u.value=!1}});return(f,o)=>{const b=n("v-btn"),R=n("v-card-title"),E=n("v-divider"),J=n("v-text-field"),B=n("v-chip"),q=n("v-list-item"),K=n("v-select"),I=n("v-card-text"),Q=n("v-card-actions"),W=n("v-card"),X=n("v-form"),Y=n("v-dialog");return x(),C(Y,{modelValue:v.value,"onUpdate:modelValue":o[6]||(o[6]=s=>v.value=s),"max-width":f.$vuetify.display.smAndUp?"400":"",persistent:u.value,fullscreen:!f.$vuetify.display.smAndUp},{default:a(()=>[e(X,{onSubmit:o[5]||(o[5]=Ce(s=>h.value?i(M)():i(A)(),["prevent"]))},{default:a(()=>[e(W,{loading:u.value,rounded:f.$vuetify.display.smAndUp?"lg":"0"},{default:a(()=>[e(R,{class:"d-flex justify-space-between align-center"},{default:a(()=>[z("div",{textContent:F(h.value?"Create new role":"Edit role")},null,8,ze),e(b,{icon:"$close",variant:"text",onClick:o[0]||(o[0]=s=>v.value=!1),disabled:u.value},null,8,["disabled"])]),_:1}),e(E,{class:"mb-4"}),e(I,null,{default:a(()=>[e(J,{"prepend-inner-icon":i(xe),modelValue:i(c).value.value,"onUpdate:modelValue":o[1]||(o[1]=s=>i(c).value.value=s),"error-messages":i(c).errorMessage.value,label:"Name",class:"mb-2",variant:"outlined",clearable:"","persistent-clear":"",disabled:u.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"]),e(K,{"prepend-inner-icon":i(Ve),modelValue:i(k).value.value,"onUpdate:modelValue":o[2]||(o[2]=s=>i(k).value.value=s),clearable:"","persistent-clear":"",label:"Color",items:r,variant:"outlined",class:"mb-2",disabled:u.value},{item:a(({props:s,item:l})=>[e(q,we(ke(s)),{title:a(()=>[e(B,{class:"font-weight-medium",color:l.value,text:l.title,density:"compact"},null,8,["color","text"])]),_:2},1040)]),selection:a(({item:s})=>[e(B,{class:"font-weight-medium",color:s.value,text:s.title},null,8,["color","text"])]),_:1},8,["prepend-inner-icon","modelValue","disabled"]),e(ce,{modelValue:i(w).value.value,"onUpdate:modelValue":o[3]||(o[3]=s=>i(w).value.value=s),disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),e(E),e(Q,{class:"ma-2"},{default:a(()=>[e(b,{type:"button",text:"Cancel",onClick:o[4]||(o[4]=s=>v.value=!1),disabled:u.value},null,8,["disabled"]),e(b,{type:"submit",color:h.value?"success":"primary",variant:"flat",text:h.value?"Create":"Update",loading:u.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"])}}},Se={__name:"RoleDeleteDialog",props:oe({role:{default:null},reloadFunction:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup($){const U=H(),p=se(),v=ne($,"modelValue"),_=$,r=m(!1);async function V(){var d;r.value=!0;try{const c=(d=_.role)==null?void 0:d.id;var y=await fetch(`${g.roleDelete.url}?role_id=${c}`,{method:g.roleDelete.method,headers:{Authorization:U.token}});y=await y.json(),p.notify(y.message,"success"),v.value=!1,_.reloadFunction()}catch(c){console.log(c)}finally{r.value=!1}}return(y,d)=>{const c=n("v-card-text"),k=n("v-btn"),w=n("v-card-actions"),u=n("v-card"),h=n("v-dialog");return x(),C(h,{modelValue:v.value,"onUpdate:modelValue":d[1]||(d[1]=M=>v.value=M),"max-width":"400",persistent:r.value},{default:a(()=>[e(u,{title:"Delete Role",loading:r.value,rounded:"lg"},{default:a(()=>[e(c,null,{default:a(()=>d[2]||(d[2]=[N(" Are you sure you want to delete this role? ")])),_:1}),e(w,{class:"ma-2"},{default:a(()=>[e(k,{text:"Cancel",onClick:d[0]||(d[0]=M=>v.value=!1),disabled:r.value},null,8,["disabled"]),e(k,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:V,loading:r.value},null,8,["loading"])]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue","persistent"])}}},je={class:"mb-5"},Fe={class:"d-flex align-center ga-2 opacity-80"},Ne=["textContent"],Be={class:"d-flex ga-2 align-center"},Oe={class:"text-no-wrap"},Te={class:"text-no-wrap"},Ee={class:"text-no-wrap"},Ge={__name:"RoleListView",setup($){const U=De(),p=H(),v=$e(),_=se(),r=m(!1),V=m([]),y=m(0),d=m(0),c=m(""),k=m(1),w=m(10),u=m([{key:"updated_at",order:"desc"}]),h=m(),M=m([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"Name",key:"name"},{title:"Permissions",key:"permissions",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"}]);async function A(){var O,T,G,P;r.value=!0;try{var s={page:k.value,limit:w.value,query:c.value,perms:h.value?h.value.join(","):"",sort_by:(O=u.value.at(0))==null?void 0:O.key,sort_order:(T=u.value.at(0))==null?void 0:T.order};s=new URLSearchParams(s);const D=`${g.roleList.url}?${s.toString()}`;var l=await fetch(D,{method:g.roleList.method,headers:{Authorization:p.token}});l=await l.json(),V.value=l==null?void 0:l.data,y.value=(G=l==null?void 0:l.pagination)==null?void 0:G.total,d.value=(P=l==null?void 0:l.pagination)==null?void 0:P.filtered}catch(D){console.log(D)}finally{r.value=!1}}Ue(()=>{p.isLoggedIn&&A()});const f=m(),o=m([]),b=m(!1),R=m(!1),E=p.isAuthorized(g.roleCreate.permission),J=p.isAuthorized(g.roleUpdate.permission),B=p.isAuthorized(g.roleDelete.permission),q=p.isAuthorized(g.roleDeleteMany.permission),K=de([J,B]),I=de([q]);K||M.value.shift();function Q(){f.value=null,b.value=!0}function W(s){f.value=s,b.value=!0}function X(s){f.value=s,R.value=!0}async function Y(){r.value=!0;try{var s=await fetch(g.roleDeleteMany.url,{method:g.roleDeleteMany.method,headers:{Authorization:p.token,"Content-Type":"application/json"},body:JSON.stringify(o.value)});s=await s.json(),_.notify(s.message,"success"),A(),o.value.length=0}catch(l){console.log(l)}finally{r.value=!1}}return(s,l)=>{const O=n("v-icon"),T=n("v-col"),G=n("v-row"),P=n("v-btn"),D=n("v-tooltip"),me=n("v-divider"),ve=n("v-toolbar"),ie=n("v-hover"),Z=n("v-chip"),re=n("v-card-text"),pe=n("v-card"),_e=n("v-menu"),fe=n("v-data-table-server");return x(),le(ae,null,[z("div",je,[z("h1",Fe,[e(O,{icon:i(U).meta.icon,size:"x-small"},null,8,["icon"]),z("span",{textContent:F(i(U).meta.title)},null,8,Ne)])]),e(G,{align:"center",justify:"start",class:"mb-2",dense:""},{default:a(()=>[e(T,{cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[z("div",Be,[e(O,{icon:"$filter",color:"medium-emphasis"}),e(Pe,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=t=>c.value=t)},null,8,["modelValue"])])]),_:1}),e(T,{cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[e(ce,{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=t=>h.value=t),density:"compact",rounded:"pill","hide-details":"","items-visibility-count":1},null,8,["modelValue"])]),_:1})]),_:1}),e(ve,null,{default:a(()=>[i(I)?(x(),le(ae,{key:0},[i(q)&&o.value.length>0?(x(),C(D,{key:0,text:"Delete selected roles"},{activator:a(({props:t})=>[e(P,j({disabled:r.value,icon:"$delete",onClick:Y},t),null,16,["disabled"])]),_:1})):S("",!0),o.value.length>0?(x(),C(me,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):S("",!0)],64)):S("",!0),i(E)?(x(),C(D,{key:1,text:"Create new role"},{activator:a(({props:t})=>[e(P,j({icon:"$plus",onClick:Q},t,{disabled:r.value}),null,16,["disabled"])]),_:1})):S("",!0),e(D,{text:"Refresh"},{activator:a(({props:t})=>[e(P,j({icon:"$refresh",onClick:A},t,{disabled:r.value}),null,16,["disabled"])]),_:1})]),_:1}),e(fe,{"loading-text":"loading roles...",headers:M.value,items:V.value,"items-length":d.value,modelValue:o.value,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value=t),page:k.value,"onUpdate:page":l[5]||(l[5]=t=>k.value=t),"items-per-page":w.value,"onUpdate:itemsPerPage":l[6]||(l[6]=t=>w.value=t),"sort-by":u.value,"onUpdate:sortBy":l[7]||(l[7]=t=>u.value=t),loading:r.value,"onUpdate:options":A,"must-sort":"",hover:"","show-select":i(I),"header-props":{class:"text-no-wrap"}},{"item.actions":a(({item:t})=>[z("div",Oe,[i(J)?(x(),C(ie,{key:0},{default:a(({isHovering:L,props:ee})=>[e(P,j({disabled:r.value},ee,{color:L?"primary":"",icon:"$edit",onClick:ge=>W(t),variant:"text",size:"small"}),null,16,["disabled","color","onClick"])]),_:2},1024)):S("",!0),i(B)?(x(),C(ie,{key:1},{default:a(({isHovering:L,props:ee})=>[e(P,j({disabled:r.value},ee,{color:L?"red-accent-4":"",icon:"$delete",onClick:ge=>X(t),variant:"text",size:"small"}),null,16,["disabled","color","onClick"])]),_:2},1024)):S("",!0)])]),"item.permissions":a(({value:t})=>[e(_e,{"open-on-hover":""},{activator:a(({props:L})=>[e(Z,j(L,{link:""}),{default:a(()=>[N(F(t.length),1)]),_:2},1040)]),default:a(()=>[e(pe,{"max-width":"300","max-height":"300",rounded:"lg"},{default:a(()=>[e(re,null,{default:a(()=>[N(F(t.length)+" permissions",1)]),_:2},1024),t.length>0?(x(),C(re,{key:0,class:"d-flex flex-wrap ga-1 pt-0"},{default:a(()=>[(x(!0),le(ae,null,Re(t,L=>(x(),C(Z,{key:L.id},{default:a(()=>[N(F(L.name),1)]),_:2},1024))),128))]),_:2},1024)):S("",!0)]),_:2},1024)]),_:2},1024)]),"item.name":a(({item:t})=>[e(Z,{class:"text-no-wrap font-weight-medium",color:t.color,density:"comfortable",text:t.name},null,8,["color","text"])]),"item.created_at":a(({value:t})=>[z("span",Te,[N(F(i(ue)(t))+" ",1),e(D,{activator:"parent",text:i(v).format(t,"fullDateTime12h")},null,8,["text"])])]),"item.updated_at":a(({value:t})=>[z("span",Ee,[N(F(i(ue)(t))+" ",1),e(D,{activator:"parent",text:i(v).format(t,"fullDateTime12h")},null,8,["text"])])]),bottom:a(()=>[e(Le,{class:"mt-2",page:k.value,"onUpdate:page":l[2]||(l[2]=t=>k.value=t),"items-per-page":w.value,"onUpdate:itemsPerPage":l[3]||(l[3]=t=>w.value=t),"items-count":V.value.length,total:y.value,filtered:d.value,label:"roles"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","show-select"]),e(Me,{modelValue:b.value,"onUpdate:modelValue":l[8]||(l[8]=t=>b.value=t),role:f.value,"reload-function":A},null,8,["modelValue","role"]),e(Se,{modelValue:R.value,"onUpdate:modelValue":l[9]||(l[9]=t=>R.value=t),role:f.value,"reload-function":A},null,8,["modelValue","role"])],64)}}};export{Ge as default};
