import{E as se,a as H,G as N,r as p,o as x,k as D,M as ne,u as i,z as ge,e as _,p as ue,q as _e,s as te,H as ce,w as o,d as l,b as P,t as L,N as ye,O as he,P as be,Q as xe,C as ke,f as n,n as F,I as we,J as Ve,c as le,F as oe,l as S,g as $e,h as Ue}from"./index-CoCbkXPQ.js";import{c as re,t as de}from"./index-zKOuXdVJ.js";import{d as Ce,_ as Re,a as De,b as ae,c as Ae}from"./AutoComplete-BbSkswQ5.js";const ve={__name:"PermissionSelectField",props:se({},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const C=H(),f=N(k,"modelValue"),v=k,s=p([]);function w(y=1,m=100){var h={page:y,limit:m};h=new URLSearchParams(h).toString(),fetch(`${_.permissionList.url}?${h}`,{headers:{Authorization:C.token}}).then(V=>V.json()).then(V=>{s.value.push(...V.data),V.pagination.filtered>s.value.length&&w(y+1)})}return w(),(y,m)=>(x(),D(Ce,ne({"prepend-inner-icon":i(ge),modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=h=>f.value=h),items:s.value,"item-title":"name","item-value":"id",label:"Permissions",variant:"outlined",clearable:"","persistent-clear":"",multiple:!0,"items-visibility-label":"permissions"},v),null,16,["prepend-inner-icon","modelValue","items"]))}},Me=["textContent"],Pe={__name:"RoleDialog",props:se({reloadFunction:{}},{dialog:{},dialogModifiers:{},role:{},roleModifiers:{}}),emits:["update:dialog","update:role"],setup(k){const C=H(),f=ue(),v=N(k,"dialog"),s=N(k,"role"),w=k,y=["primary","secondary","accent","error","info","success","warning"],{handleSubmit:m,handleReset:h,setValues:V}=_e({validationSchema:{name:"required",color:`one_of:${y}`,permissions:""}}),r=te("name"),d=te("color"),g=te("permissions"),u=p(!1),$=p(!1);ce(v,c=>{c&&s.value?(V(s.value),g.setValue(s.value.permissions.map(a=>a.id)),$.value=!1):(s.value=null,h(),g.resetField({value:[]}),$.value=!0)});const A=m(async c=>{u.value=!0;try{var a=await fetch(_.roleCreate.url,{method:_.roleCreate.method,headers:{Authorization:C.token,"Content-Type":"application/json"},body:JSON.stringify(c)});a=await a.json(),f.notify(a.message,"success"),v.value=!1,w.reloadFunction()}catch(b){console.log(b)}finally{u.value=!1}}),U=m(async c=>{var b;u.value=!0;try{const z=(b=s.value)==null?void 0:b.id;var a=await fetch(`${_.roleUpdate.url}?role_id=${z}`,{method:_.roleUpdate.method,headers:{Authorization:C.token,"Content-Type":"application/json"},body:JSON.stringify(c)});a=await a.json(),f.notify(a.message,"success"),v.value=!1,w.reloadFunction()}catch(z){console.log(z)}finally{u.value=!1}});return(c,a)=>{const b=n("v-btn"),z=n("v-card-title"),O=n("v-divider"),J=n("v-text-field"),T=n("v-chip"),Q=n("v-list-item"),q=n("v-select"),K=n("v-card-text"),W=n("v-card-actions"),X=n("v-card"),Y=n("v-form"),R=n("v-dialog");return x(),D(R,{modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=e=>v.value=e),"max-width":c.$vuetify.display.smAndUp?"400":"",persistent:u.value,fullscreen:!c.$vuetify.display.smAndUp},{default:o(()=>[l(Y,{onSubmit:a[5]||(a[5]=ke(e=>$.value?i(A)():i(U)(),["prevent"]))},{default:o(()=>[l(X,{loading:u.value,rounded:c.$vuetify.display.smAndUp?"lg":"0"},{default:o(()=>[l(z,{class:"d-flex justify-space-between align-center"},{default:o(()=>[P("div",{textContent:L($.value?"Create new role":"Edit role")},null,8,Me),l(b,{icon:"$close",variant:"text",onClick:a[0]||(a[0]=e=>v.value=!1),disabled:u.value},null,8,["disabled"])]),_:1}),l(O,{class:"mb-4"}),l(K,null,{default:o(()=>[l(J,{"prepend-inner-icon":i(ye),modelValue:i(r).value.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i(r).value.value=e),"error-messages":i(r).errorMessage.value,label:"Name",class:"mb-2",variant:"outlined",clearable:"","persistent-clear":"",disabled:u.value},null,8,["prepend-inner-icon","modelValue","error-messages","disabled"]),l(q,{"prepend-inner-icon":i(he),modelValue:i(d).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i(d).value.value=e),clearable:"","persistent-clear":"",label:"Color",items:y,variant:"outlined",class:"mb-2",disabled:u.value},{item:o(({props:e,item:M})=>[l(Q,be(xe(e)),{title:o(()=>[l(T,{class:"font-weight-medium",color:M.value,text:M.title,density:"compact"},null,8,["color","text"])]),_:2},1040)]),selection:o(({item:e})=>[l(T,{class:"font-weight-medium",color:e.value,text:e.title},null,8,["color","text"])]),_:1},8,["prepend-inner-icon","modelValue","disabled"]),l(ve,{modelValue:i(g).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>i(g).value.value=e),disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),l(O),l(W,{class:"ma-2"},{default:o(()=>[l(b,{type:"button",text:"Cancel",onClick:a[4]||(a[4]=e=>v.value=!1),disabled:u.value},null,8,["disabled"]),l(b,{type:"submit",color:$.value?"success":"primary",variant:"flat",text:$.value?"Create":"Update",loading:u.value},null,8,["color","text","loading"])]),_:1})]),_:1},8,["loading","rounded"])]),_:1})]),_:1},8,["modelValue","max-width","persistent","fullscreen"])}}},Le={__name:"RoleDeleteDialog",props:se({reloadFunction:{}},{dialog:{},dialogModifiers:{},role:{},roleModifiers:{},roles:{default:[]},rolesModifiers:{}}),emits:["update:dialog","update:role","update:roles"],setup(k){const C=H(),f=ue(),v=N(k,"dialog"),s=N(k,"role"),w=N(k,"roles"),y=k,m=p(!1);ce(v,r=>{r||(s.value=null,w.value.length=0)});async function h(){var d;m.value=!0;try{const g=(d=s.value)==null?void 0:d.id;var r=await fetch(`${_.roleDelete.url}?role_id=${g}`,{method:_.roleDelete.method,headers:{Authorization:C.token}});r=await r.json(),f.notify(r.message,"success"),v.value=!1,y.reloadFunction()}catch(g){console.log(g)}finally{m.value=!1}}async function V(){m.value=!0;try{var r=await fetch(_.roleDeleteMany.url,{method:_.roleDeleteMany.method,headers:{Authorization:C.token,"Content-Type":"application/json"},body:JSON.stringify(w.value)});r=await r.json(),f.notify(r.message,"success"),v.value=!1,y.reloadFunction()}catch(d){console.log(d)}finally{m.value=!1}}return(r,d)=>{const g=n("v-card-text"),u=n("v-btn"),$=n("v-card-actions"),A=n("v-card"),U=n("v-dialog");return x(),D(U,{modelValue:v.value,"onUpdate:modelValue":d[2]||(d[2]=c=>v.value=c),"max-width":"400",persistent:m.value},{default:o(()=>[l(A,{title:`Delete ${s.value?"Role":"Roles"}`,loading:m.value,rounded:"lg"},{default:o(()=>[l(g,null,{default:o(()=>[F(" Are you sure you want to delete "+L(s.value?"this role":"the selected roles")+"? ",1)]),_:1}),l($,{class:"ma-2"},{default:o(()=>[l(u,{text:"Cancel",onClick:d[0]||(d[0]=c=>v.value=!1),disabled:m.value},null,8,["disabled"]),l(u,{color:"red-accent-4",variant:"flat",text:"Delete",onClick:d[1]||(d[1]=c=>s.value?h():V()),loading:m.value},null,8,["loading"])]),_:1})]),_:1},8,["title","loading"])]),_:1},8,["modelValue","persistent"])}}},ze={class:"mb-5"},Se={class:"d-flex align-center ga-2 opacity-80"},je=["textContent"],Fe={class:"d-flex ga-2 align-center"},Ne={class:"text-no-wrap"},Oe={class:"text-no-wrap"},Te={class:"text-no-wrap"},qe={__name:"RoleListView",setup(k){const C=Ue(),f=H(),v=we(),s=p(!1),w=p([]),y=p([]),m=p(0),h=p(0),V=p(""),r=p(1),d=p(10),g=p([{key:"updated_at",order:"desc"}]),u=p(),$=p([{title:"Action",value:"actions",sortable:!1},{title:"Id",key:"id"},{title:"Name",key:"name"},{title:"Permissions",key:"permissions",sortable:!1},{title:"Created at",key:"created_at"},{title:"Updated at",key:"updated_at"}]);async function A(){var M,B,I,G;s.value=!0;try{var R={page:r.value,limit:d.value,query:V.value,perms:u.value?u.value.join(","):"",sort_by:(M=g.value.at(0))==null?void 0:M.key,sort_order:(B=g.value.at(0))==null?void 0:B.order};R=new URLSearchParams(R);const E=`${_.roleList.url}?${R.toString()}`;var e=await fetch(E,{method:_.roleList.method,headers:{Authorization:f.token}});e=await e.json(),y.value=e==null?void 0:e.data,m.value=(I=e==null?void 0:e.pagination)==null?void 0:I.total,h.value=(G=e==null?void 0:e.pagination)==null?void 0:G.filtered}catch(E){console.log(E)}finally{s.value=!1}}Ve(()=>{f.isLoggedIn&&A()});const U=p(),c=p([]),a=p(!1),b=p(!1),z=f.isAuthorized(_.roleCreate.permission),O=f.isAuthorized(_.roleUpdate.permission),J=f.isAuthorized(_.roleDelete.permission),T=f.isAuthorized(_.roleDeleteMany.permission),Q=re([O,J]),q=re([T]);Q||$.value.shift();function K(){U.value=null,a.value=!0}function W(R){U.value=R,a.value=!0}function X(R){U.value=R,b.value=!0}function Y(){b.value=!0}return(R,e)=>{const M=n("v-icon"),B=n("v-col"),I=n("v-row"),G=n("v-divider"),E=n("v-btn"),Z=n("v-tooltip"),ee=n("v-chip"),ie=n("v-card-text"),me=n("v-card"),pe=n("v-menu"),fe=n("v-data-table-server");return x(),le(oe,null,[P("div",ze,[P("h1",Se,[l(M,{icon:i(C).meta.icon,size:"x-small"},null,8,["icon"]),P("span",{textContent:L(i(C).meta.title)},null,8,je)])]),l(I,{align:"center",justify:"start",class:"mb-2",dense:""},{default:o(()=>[l(B,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[P("div",Fe,[l(M,{icon:"$filter",color:"medium-emphasis"}),l(De,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t)},null,8,["modelValue"])])]),_:1}),l(B,{cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[l(ve,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),density:"compact",rounded:"pill","hide-details":"","items-visibility-count":1},null,8,["modelValue"])]),_:1})]),_:1}),l(Re,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),"is-loading":s.value,"refresh-action":A,columns:$.value},{prepend:o(()=>[i(q)?(x(),le(oe,{key:0},[i(T)&&c.value.length>0?(x(),D(ae,{key:0,"tooltip-label":"Delete selected roles","is-loading":s.value,onClick:Y,icon:"$delete",size:"default","change-color-on-hover":!1},null,8,["is-loading"])):S("",!0),c.value.length>0?(x(),D(G,{key:1,class:"mx-3 align-self-center",vertical:"",length:"24",thickness:"2"})):S("",!0)],64)):S("",!0),i(z)?(x(),D(Z,{key:1,"open-on-click":"",text:"Create new role"},{activator:o(({props:t})=>[l(E,ne({icon:"$plus",onClick:K},t,{disabled:s.value}),null,16,["disabled"])]),_:1})):S("",!0)]),_:1},8,["modelValue","is-loading","columns"]),l(fe,{"loading-text":"loading roles...",headers:w.value,items:y.value,"items-length":h.value,modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),page:r.value,"onUpdate:page":e[6]||(e[6]=t=>r.value=t),"items-per-page":d.value,"onUpdate:itemsPerPage":e[7]||(e[7]=t=>d.value=t),"sort-by":g.value,"onUpdate:sortBy":e[8]||(e[8]=t=>g.value=t),loading:s.value,"onUpdate:options":A,"disable-sort":s.value,"must-sort":"",hover:"","show-select":i(q),"header-props":{class:"text-no-wrap"}},{"item.actions":o(({item:t})=>[P("div",Ne,[i(O)?(x(),D(ae,{key:0,"tooltip-label":"Edit","is-loading":s.value,onClick:j=>W(t),icon:"$edit"},null,8,["is-loading","onClick"])):S("",!0),i(J)&&!t.deleted?(x(),D(ae,{key:1,"tooltip-label":"Delete","is-loading":s.value,onClick:j=>X(t),icon:"$delete","color-on-hover":"red"},null,8,["is-loading","onClick"])):S("",!0)])]),"item.permissions":o(({value:t})=>[l(pe,{"open-on-hover":"","open-on-click":""},{activator:o(({props:j})=>[l(ee,ne(j,{link:""}),{default:o(()=>[F(L(t.length),1)]),_:2},1040)]),default:o(()=>[l(me,{"max-width":"300","max-height":"300",rounded:"lg"},{default:o(()=>[l(ie,null,{default:o(()=>[F(L(t.length)+" permissions",1)]),_:2},1024),t.length>0?(x(),D(ie,{key:0,class:"d-flex flex-wrap ga-1 pt-0"},{default:o(()=>[(x(!0),le(oe,null,$e(t,j=>(x(),D(ee,{key:j.id},{default:o(()=>[F(L(j.name),1)]),_:2},1024))),128))]),_:2},1024)):S("",!0)]),_:2},1024)]),_:2},1024)]),"item.name":o(({item:t})=>[l(ee,{class:"text-no-wrap font-weight-medium",color:t.color,density:"comfortable",text:t.name},null,8,["color","text"])]),"item.created_at":o(({value:t})=>[P("span",Oe,[F(L(i(de)(t))+" ",1),l(Z,{activator:"parent",text:i(v).format(t,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),"item.updated_at":o(({value:t})=>[P("span",Te,[F(L(i(de)(t))+" ",1),l(Z,{activator:"parent",text:i(v).format(t,"fullDateTime12h"),"open-on-click":""},null,8,["text"])])]),bottom:o(()=>[l(Ae,{class:"mt-2",page:r.value,"onUpdate:page":e[3]||(e[3]=t=>r.value=t),"items-per-page":d.value,"onUpdate:itemsPerPage":e[4]||(e[4]=t=>d.value=t),"items-count":y.value.length,total:m.value,filtered:h.value,label:"roles"},null,8,["page","items-per-page","items-count","total","filtered"])]),_:1},8,["headers","items","items-length","modelValue","page","items-per-page","sort-by","loading","disable-sort","show-select"]),l(Pe,{dialog:a.value,"onUpdate:dialog":e[9]||(e[9]=t=>a.value=t),role:U.value,"onUpdate:role":e[10]||(e[10]=t=>U.value=t),"reload-function":A},null,8,["dialog","role"]),l(Le,{dialog:b.value,"onUpdate:dialog":e[11]||(e[11]=t=>b.value=t),role:U.value,"onUpdate:role":e[12]||(e[12]=t=>U.value=t),roles:c.value,"onUpdate:roles":e[13]||(e[13]=t=>c.value=t),"reload-function":A},null,8,["dialog","role","roles"])],64)}}};export{qe as default};
